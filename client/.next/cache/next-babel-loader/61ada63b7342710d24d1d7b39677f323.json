{"ast":null,"code":"import _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/objectSpread\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/assertThisInitialized\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/defineProperty\";\nimport React from 'react';\nimport Head from 'next/head';\nimport _ from 'lodash'; // import moment from 'moment'\n\nimport ReactTable from 'react-table';\nimport toastr from 'toastr';\nimport querystring from 'qs';\nimport userOnly from '../../hocs/userOnly';\nimport { userService } from '../../services';\nimport { Link, Router } from '../../../common/routes';\nimport { Rank } from '../../../common/models/User';\nimport Error from 'next/error';\nimport Role from '../../../common/models/Role';\nvar DEFAULT_SEARCH_CRITERIA = {\n  page: 0,\n  pageSize: 10,\n  filtered: [],\n  sorted: [{\n    id: 'createdAt',\n    desc: 'true'\n  }]\n};\n\nvar ManageAgents =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ManageAgents, _React$Component);\n\n  _createClass(ManageAgents, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(ctx) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", {\n                  headerText: 'Manage Agents'\n                });\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function ManageAgents(props) {\n    var _this;\n\n    _classCallCheck(this, ManageAgents);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ManageAgents).call(this, props)); // Parse querystring from browser URL to search criteria compatible with react-table\n\n    _defineProperty(_assertThisInitialized(_this), \"_moveUpToPartner\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(id, rank, cash) {\n        var _querystring$parse, _querystring$parse$so, sorted, _querystring$parse$pa, pageSize, _querystring$parse$pa2, page, _querystring$parse$fi, filtered;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _querystring$parse = querystring.parse(_this.props.router.query), _querystring$parse$so = _querystring$parse.sorted, sorted = _querystring$parse$so === void 0 ? DEFAULT_SEARCH_CRITERIA.sorted : _querystring$parse$so, _querystring$parse$pa = _querystring$parse.pageSize, pageSize = _querystring$parse$pa === void 0 ? DEFAULT_SEARCH_CRITERIA.pageSize : _querystring$parse$pa, _querystring$parse$pa2 = _querystring$parse.page, page = _querystring$parse$pa2 === void 0 ? DEFAULT_SEARCH_CRITERIA.page : _querystring$parse$pa2, _querystring$parse$fi = _querystring$parse.filtered, filtered = _querystring$parse$fi === void 0 ? DEFAULT_SEARCH_CRITERIA.filtered : _querystring$parse$fi;\n                sorted.forEach(function (sort) {\n                  return sort.desc = sort.desc === 'true';\n                });\n                _context2.next = 4;\n                return userService.updateRankAndCash(id, rank, cash);\n\n              case 4:\n                toastr.success('Saved');\n\n                _this._fetchData({\n                  pageSize: pageSize,\n                  page: page,\n                  sorted: sorted,\n                  filtered: filtered\n                });\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x2, _x3, _x4) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_fetchData\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(_ref2) {\n        var _ref2$pageSize, pageSize, _ref2$page, page, _ref2$sorted, sorted, _ref2$filtered, filtered, where, order, _ref4, total, users, pages, newState, pagePath;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _ref2$pageSize = _ref2.pageSize, pageSize = _ref2$pageSize === void 0 ? DEFAULT_SEARCH_CRITERIA.pageSize : _ref2$pageSize, _ref2$page = _ref2.page, page = _ref2$page === void 0 ? DEFAULT_SEARCH_CRITERIA.page : _ref2$page, _ref2$sorted = _ref2.sorted, sorted = _ref2$sorted === void 0 ? DEFAULT_SEARCH_CRITERIA.sorted : _ref2$sorted, _ref2$filtered = _ref2.filtered, filtered = _ref2$filtered === void 0 ? DEFAULT_SEARCH_CRITERIA.filtered : _ref2$filtered;\n\n                _this.setState({\n                  loading: true\n                }); // Convert react-table search criteria into value that service can understand\n\n\n                where = filtered.reduce(function (acc, val) {\n                  switch (val.id) {\n                    case 'rank':\n                      if (val.value === Rank.AGENT) {\n                        acc[val.id] = Rank.AGENT;\n                      } else if (val.value === Rank.VICE_PRESIDENT) {\n                        acc[val.id] = Rank.VICE_PRESIDENT;\n                      } else if (val.value === Rank.EXECUTIVE_AGENT) {\n                        acc[val.id] = Rank.EXECUTIVE_AGENT;\n                      } else if (val.value === Rank.PARTNER) {\n                        acc[val.id] = Rank.PARTNER;\n                      }\n\n                      break;\n\n                    case 'id':\n                      {\n                        acc[val.id] = val.value;\n                        break;\n                      }\n\n                    default:\n                      {\n                        acc[val.id] = {\n                          regexp: \"/\".concat(val.value, \"/i\")\n                        };\n                      }\n                  }\n\n                  return acc;\n                }, {\n                  or: [{\n                    rank: Rank.AGENT\n                  }, {\n                    rank: Rank.EXECUTIVE_AGENT\n                  }]\n                });\n                order = _.get(sorted, '[0].id', 'createdAt') + \" \".concat(_.get(sorted, '[0].desc') ? 'desc' : 'asc');\n                _context3.prev = 4;\n                _context3.next = 7;\n                return userService.getUsersForAdmin({\n                  where: where,\n                  skip: pageSize * page,\n                  order: order,\n                  limit: pageSize\n                });\n\n              case 7:\n                _ref4 = _context3.sent;\n                total = _ref4.total;\n                users = _ref4.users;\n                pages = Math.ceil(total / pageSize); // Show the last page if user intentionally hard-code the page value on browser URL to be very large\n\n                newState = {\n                  pages: pages,\n                  users: users\n                };\n\n                if (page > pages - 1) {\n                  newState.searchCriteria = _objectSpread({}, _this.state.searchCriteria, {\n                    page: Math.max(0, pages - 1) // Avoid edge case when pages = 0 resulting in -1 value, should be at least 0\n\n                  });\n                }\n\n                _this.setState(newState); // Persist search criteria to browser URL\n\n\n                pagePath = \"/manage-agents?\".concat(querystring.stringify({\n                  pageSize: pageSize,\n                  page: page,\n                  sorted: sorted,\n                  filtered: filtered\n                }));\n                Router.replaceRoute(pagePath);\n                _context3.next = 21;\n                break;\n\n              case 18:\n                _context3.prev = 18;\n                _context3.t0 = _context3[\"catch\"](4);\n                toastr.error(_context3.t0.message);\n\n              case 21:\n                _context3.prev = 21;\n\n                _this.setState({\n                  loading: false\n                });\n\n                return _context3.finish(21);\n\n              case 24:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[4, 18, 21, 24]]);\n      }));\n\n      return function (_x5) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_deleteUser\",\n    /*#__PURE__*/\n    function () {\n      var _ref5 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(id) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!confirm('Are you sure you wish to delete this user?')) {\n                  _context4.next = 15;\n                  break;\n                }\n\n                _context4.prev = 1;\n\n                _this.setState({\n                  loading: true\n                });\n\n                _context4.next = 5;\n                return userService.deleteUserWithId(id);\n\n              case 5:\n                _context4.next = 7;\n                return _this._fetchData(_this.state.searchCriteria);\n\n              case 7:\n                _context4.next = 12;\n                break;\n\n              case 9:\n                _context4.prev = 9;\n                _context4.t0 = _context4[\"catch\"](1);\n                toastr.error(_context4.t0);\n\n              case 12:\n                _context4.prev = 12;\n\n                _this.setState({\n                  loading: false\n                });\n\n                return _context4.finish(12);\n\n              case 15:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[1, 9, 12, 15]]);\n      }));\n\n      return function (_x6) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_updateSearchCriteria\", function (key) {\n      return function (value) {\n        _this.setState({\n          searchCriteria: _objectSpread({}, _this.state.searchCriteria, _defineProperty({}, key, value))\n        });\n      };\n    });\n\n    var _querystring$parse2 = querystring.parse(props.router.query),\n        _querystring$parse2$s = _querystring$parse2.sorted,\n        _sorted = _querystring$parse2$s === void 0 ? DEFAULT_SEARCH_CRITERIA.sorted : _querystring$parse2$s,\n        _querystring$parse2$p = _querystring$parse2.pageSize,\n        _pageSize = _querystring$parse2$p === void 0 ? DEFAULT_SEARCH_CRITERIA.pageSize : _querystring$parse2$p,\n        _querystring$parse2$p2 = _querystring$parse2.page,\n        _page = _querystring$parse2$p2 === void 0 ? DEFAULT_SEARCH_CRITERIA.page : _querystring$parse2$p2,\n        _querystring$parse2$f = _querystring$parse2.filtered,\n        _filtered = _querystring$parse2$f === void 0 ? DEFAULT_SEARCH_CRITERIA.filtered : _querystring$parse2$f;\n\n    _sorted.forEach(function (sort) {\n      return sort.desc = sort.desc === 'true';\n    });\n\n    _this.state = {\n      total: 0,\n      pages: 0,\n      users: [],\n      searchCriteria: {\n        pageSize: _parseInt(_pageSize),\n        page: _parseInt(_page),\n        sorted: _sorted,\n        filtered: _filtered\n      },\n      loading: false\n    };\n    _this._debouncedFetchData = _.debounce(_this._fetchData, 200);\n    return _this;\n  }\n\n  _createClass(ManageAgents, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          users = _this$state.users,\n          pages = _this$state.pages,\n          loading = _this$state.loading,\n          searchCriteria = _this$state.searchCriteria;\n      var page = searchCriteria.page,\n          pageSize = searchCriteria.pageSize,\n          filtered = searchCriteria.filtered,\n          sorted = searchCriteria.sorted;\n      var _this$props = this.props,\n          t = _this$props.t,\n          currentUser = _this$props.currentUser;\n\n      if (currentUser.roles[0].name !== Role.COORDINATOR) {\n        return React.createElement(Error, {\n          statusCode: 404\n        });\n      }\n\n      return React.createElement(\"div\", {\n        className: \"box-main\"\n      }, React.createElement(Head, null, React.createElement(\"title\", null, \"Manage Agents\")), React.createElement(\"section\", {\n        className: \"content\"\n      }, React.createElement(\"div\", {\n        className: \"\"\n      }, React.createElement(\"div\", {\n        className: \"card shadow-sm rounded\"\n      }, React.createElement(\"div\", {\n        className: \"card-header\"\n      }, React.createElement(\"span\", {\n        className: \"card-title\",\n        style: {\n          fontSize: '1.25rem'\n        }\n      }, \"Agents\"), React.createElement(\"div\", {\n        className: \"card-tools\"\n      }, React.createElement(\"button\", {\n        type: \"button\",\n        className: \"btn btn-secondary mr-2\",\n        onClick: function onClick() {\n          return _this2.setState({\n            searchCriteria: DEFAULT_SEARCH_CRITERIA\n          });\n        }\n      }, t('admin:clearSearch')))), React.createElement(\"div\", {\n        className: \"card-body\"\n      }, React.createElement(\"section\", {\n        className: \"content\"\n      }, React.createElement(\"div\", {\n        className: \"card\"\n      }, React.createElement(ReactTable, {\n        data: users,\n        columns: [{\n          Header: 'Agent ID',\n          accessor: 'id',\n          filterable: false\n        }, {\n          id: t('firstName'),\n          Header: t('First name'),\n          accessor: function accessor(d) {\n            return d.firstName ? \"\".concat(d.firstName) : \"\".concat(d.name);\n          }\n        }, {\n          id: t('lastName'),\n          Header: t('Last name'),\n          accessor: function accessor(d) {\n            return d.lastName ? \"\".concat(d.lastName) : '';\n          }\n        }, {\n          Header: 'Agent Level',\n          accessor: 'rank',\n          sortable: false,\n          Cell: function Cell(row) {\n            return row.value === Rank.AGENT ? React.createElement(\"span\", {\n              className: \"badge badge-danger text-capitalize\"\n            }, Rank.AGENT) : row.value === Rank.EXECUTIVE_AGENT ? React.createElement(\"span\", {\n              className: \"badge badge-success text-capitalize\"\n            }, Rank.EXECUTIVE_AGENT.replace(/-/g, ' ')) : row.value === Rank.VICE_PRESIDENT ? React.createElement(React.Fragment, null, React.createElement(\"span\", {\n              className: \"badge badge-warning text-capitalize\"\n            }, Rank.VICE_PRESIDENT.replace(/-/g, ' ')), row.original.cash >= 400000 && React.createElement(\"button\", {\n              type: \"button\",\n              className: \"btn\",\n              \"data-toggle\": \"tooltip\",\n              title: \"Move up to PARTNER\",\n              onClick: function onClick() {\n                return window.confirm('Move up this Agent to Partner') && _this2._moveUpToPartner(row.original.id, Rank.PARTNER, row.original.cash);\n              }\n            }, React.createElement(\"i\", {\n              className: \"fas fa-arrow-circle-up pull-right text-info\"\n            }))) : React.createElement(\"span\", {\n              className: \"badge badge-info text-capitalize\"\n            }, Rank.PARTNER);\n          },\n          Filter: function Filter(_ref6) {\n            var filter = _ref6.filter,\n                _onChange = _ref6.onChange;\n            return React.createElement(\"select\", {\n              onChange: function onChange(event) {\n                return _onChange(event.target.value);\n              },\n              className: \"form-control form-control-sm text-capitalize\",\n              value: filter ? filter.value : 'all'\n            }, React.createElement(\"option\", {\n              value: \"all\"\n            }, \"All\"), React.createElement(\"option\", {\n              value: \"\".concat(Rank.AGENT)\n            }, \"\".concat(Rank.AGENT)), React.createElement(\"option\", {\n              value: \"\".concat(Rank.EXECUTIVE_AGENT)\n            }, \"\".concat(Rank.EXECUTIVE_AGENT.replace(/-/g, ' '))));\n          }\n        }, {\n          Header: 'Agent total commission gain',\n          accessor: 'cash',\n          filterable: false\n        }, {\n          columns: [{\n            Header: function Header() {\n              return React.createElement(\"span\", null, t('Actions'));\n            },\n            width: 100,\n            accessor: 'id',\n            sortable: false,\n            filterable: false,\n            Cell: function Cell(props) {\n              return React.createElement(\"div\", {\n                className: \"text-center\"\n              }, React.createElement(Link, {\n                route: \"/manage-agents/\".concat(props.value, \"/edit\")\n              }, React.createElement(\"a\", {\n                className: \"btn btn-sm btn-info \",\n                \"data-toggle\": \"tooltip\",\n                title: \"Edit\"\n              }, React.createElement(\"i\", {\n                className: \"fa fa-edit\"\n              }))), \"\\xA0\", React.createElement(Link, {\n                route: \"/manage-agents/\".concat(props.value, \"/agent-transactions\")\n              }, React.createElement(\"a\", {\n                className: \"btn btn-sm btn-info \",\n                \"data-toggle\": \"tooltip\",\n                title: \"Agent's transactions\"\n              }, React.createElement(\"i\", {\n                className: \"fa fa-share-alt\"\n              }))));\n            }\n          }]\n        }],\n        filterable: true,\n        manual: true,\n        onFetchData: this._debouncedFetchData,\n        pageSize: pageSize,\n        sorted: sorted,\n        page: page,\n        filtered: filtered,\n        onPageChange: this._updateSearchCriteria('page'),\n        onPageSizeChange: this._updateSearchCriteria('pageSize'),\n        onSortedChange: this._updateSearchCriteria('sorted'),\n        onFilteredChange: this._updateSearchCriteria('filtered'),\n        loading: loading,\n        pages: pages,\n        className: \"-striped -highlight\"\n      }))))))), React.createElement(\"footer\", {\n        className: \"footer-card\",\n        style: {\n          padding: '2rem 0rem'\n        }\n      }, React.createElement(\"div\", {\n        className: \"footer-page\"\n      }, React.createElement(\"div\", {\n        className: \"footer-p1\"\n      }, \"\\xA9 Copyright Link Management Systems. All rights reserved\"), React.createElement(\"div\", {\n        className: \"footer-p2\"\n      }, \"Powered by Link Brokerages\"))));\n    }\n  }]);\n\n  return ManageAgents;\n}(React.Component);\n\nexport default userOnly(ManageAgents);","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/ManageAgents/index.js"],"names":["React","Head","_","ReactTable","toastr","querystring","userOnly","userService","Link","Router","Rank","Error","Role","DEFAULT_SEARCH_CRITERIA","page","pageSize","filtered","sorted","id","desc","ManageAgents","ctx","headerText","props","rank","cash","parse","router","query","forEach","sort","updateRankAndCash","success","_fetchData","setState","loading","where","reduce","acc","val","value","AGENT","VICE_PRESIDENT","EXECUTIVE_AGENT","PARTNER","regexp","or","order","get","getUsersForAdmin","skip","limit","total","users","pages","Math","ceil","newState","searchCriteria","state","max","pagePath","stringify","replaceRoute","error","message","confirm","deleteUserWithId","key","_debouncedFetchData","debounce","t","currentUser","roles","name","COORDINATOR","fontSize","Header","accessor","filterable","d","firstName","lastName","sortable","Cell","row","replace","original","window","_moveUpToPartner","Filter","filter","onChange","event","target","columns","width","_updateSearchCriteria","padding","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport Head from 'next/head'\nimport _ from 'lodash'\n// import moment from 'moment'\nimport ReactTable from 'react-table'\nimport toastr from 'toastr'\nimport querystring from 'qs'\nimport userOnly from '../../hocs/userOnly'\nimport { userService } from '../../services'\nimport { Link, Router } from '../../../common/routes'\nimport { Rank } from '../../../common/models/User'\nimport Error from 'next/error'\nimport Role from '../../../common/models/Role'\n\nconst DEFAULT_SEARCH_CRITERIA = {\n  page: 0,\n  pageSize: 10,\n  filtered: [],\n  sorted: [{ id: 'createdAt', desc: 'true' }]\n}\n\nclass ManageAgents extends React.Component {\n  static async getInitialProps (ctx) {\n    return {\n      headerText: 'Manage Agents'\n    }\n  }\n\n  constructor (props) {\n    super(props)\n\n    // Parse querystring from browser URL to search criteria compatible with react-table\n    const {\n      sorted = DEFAULT_SEARCH_CRITERIA.sorted,\n      pageSize = DEFAULT_SEARCH_CRITERIA.pageSize,\n      page = DEFAULT_SEARCH_CRITERIA.page,\n      filtered = DEFAULT_SEARCH_CRITERIA.filtered\n    } = querystring.parse(props.router.query)\n    sorted.forEach(sort => (sort.desc = sort.desc === 'true'))\n\n    this.state = {\n      total: 0,\n      pages: 0,\n      users: [],\n      searchCriteria: {\n        pageSize: parseInt(pageSize),\n        page: parseInt(page),\n        sorted,\n        filtered\n      },\n      loading: false\n    }\n    this._debouncedFetchData = _.debounce(this._fetchData, 200)\n  }\n\n  render () {\n    const { users, pages, loading, searchCriteria } = this.state\n    const { page, pageSize, filtered, sorted } = searchCriteria\n    const { t, currentUser } = this.props\n    if (currentUser.roles[0].name !== Role.COORDINATOR) {\n      return <Error statusCode={404} />\n    }\n    return (\n      <div className='box-main'>\n        <Head>\n          <title>Manage Agents</title>\n        </Head>\n        <section className='content'>\n          <div className=''>\n            <div className='card shadow-sm rounded'>\n              <div className='card-header'>\n                <span className='card-title' style={{ fontSize: '1.25rem' }}>\n                  Agents\n                </span>\n                <div className='card-tools'>\n                  <button\n                    type='button'\n                    className='btn btn-secondary mr-2'\n                    onClick={() =>\n                      this.setState({ searchCriteria: DEFAULT_SEARCH_CRITERIA })\n                    }\n                  >\n                    {t('admin:clearSearch')}\n                  </button>\n                </div>\n              </div>\n              <div className='card-body'>\n                <section className='content'>\n                  <div className='card'>\n                    <ReactTable\n                      data={users}\n                      columns={[\n                        {\n                          Header: 'Agent ID',\n                          accessor: 'id',\n                          filterable: false\n                        },\n                        {\n                          id: t('firstName'),\n                          Header: t('First name'),\n                          accessor: d =>\n                            d.firstName ? `${d.firstName}` : `${d.name}`\n                        },\n                        {\n                          id: t('lastName'),\n                          Header: t('Last name'),\n                          accessor: d => (d.lastName ? `${d.lastName}` : '')\n                        },\n                        {\n                          Header: 'Agent Level',\n                          accessor: 'rank',\n                          sortable: false,\n                          Cell: row =>\n                            row.value === Rank.AGENT ? (\n                              <span className='badge badge-danger text-capitalize'>\n                                {Rank.AGENT}\n                              </span>\n                            ) : row.value === Rank.EXECUTIVE_AGENT ? (\n                              <span className='badge badge-success text-capitalize'>\n                                {Rank.EXECUTIVE_AGENT.replace(/-/g, ' ')}\n                              </span>\n                            ) : row.value === Rank.VICE_PRESIDENT ? (\n                              <>\n                                <span className='badge badge-warning text-capitalize'>\n                                  {Rank.VICE_PRESIDENT.replace(/-/g, ' ')}\n                                </span>\n                                {row.original.cash >= 400000 && (\n                                  <button\n                                    type='button'\n                                    className='btn'\n                                    data-toggle='tooltip'\n                                    title='Move up to PARTNER'\n                                    onClick={() =>\n                                      window.confirm(\n                                        'Move up this Agent to Partner'\n                                      ) &&\n                                      this._moveUpToPartner(\n                                        row.original.id,\n                                        Rank.PARTNER,\n                                        row.original.cash\n                                      )\n                                    }\n                                  >\n                                    <i className='fas fa-arrow-circle-up pull-right text-info' />\n                                  </button>\n                                )}\n                              </>\n                            ) : (\n                              <span className='badge badge-info text-capitalize'>\n                                {Rank.PARTNER}\n                              </span>\n                            ),\n                          Filter: ({ filter, onChange }) => (\n                            <select\n                              onChange={event => onChange(event.target.value)}\n                              className='form-control form-control-sm text-capitalize'\n                              value={filter ? filter.value : 'all'}\n                            >\n                              <option value='all'>All</option>\n                              <option value={`${Rank.AGENT}`}>{`${\n                                Rank.AGENT\n                              }`}</option>\n                              <option\n                                value={`${Rank.EXECUTIVE_AGENT}`}\n                              >{`${Rank.EXECUTIVE_AGENT.replace(\n                                  /-/g,\n                                  ' '\n                                )}`}</option>\n                            </select>\n                          )\n                        },\n                        {\n                          Header: 'Agent total commission gain',\n                          accessor: 'cash',\n                          filterable: false\n                        },\n                        {\n                          columns: [\n                            {\n                              Header: () => <span>{t('Actions')}</span>,\n                              width: 100,\n                              accessor: 'id',\n                              sortable: false,\n                              filterable: false,\n                              Cell: props => (\n                                <div className='text-center'>\n                                  <Link\n                                    route={`/manage-agents/${props.value}/edit`}\n                                  >\n                                    <a\n                                      className='btn btn-sm btn-info '\n                                      data-toggle='tooltip'\n                                      title='Edit'\n                                    >\n                                      <i className='fa fa-edit' />\n                                    </a>\n                                  </Link>\n                                  &nbsp;\n                                  <Link\n                                    route={`/manage-agents/${\n                                      props.value\n                                    }/agent-transactions`}\n                                  >\n                                    <a\n                                      className='btn btn-sm btn-info '\n                                      data-toggle='tooltip'\n                                      title={`Agent's transactions`}\n                                    >\n                                      <i className='fa fa-share-alt' />\n                                    </a>\n                                  </Link>\n                                </div>\n                              )\n                            }\n                          ]\n                        }\n                      ]}\n                      filterable\n                      manual\n                      onFetchData={this._debouncedFetchData}\n                      pageSize={pageSize}\n                      sorted={sorted}\n                      page={page}\n                      filtered={filtered}\n                      onPageChange={this._updateSearchCriteria('page')}\n                      onPageSizeChange={this._updateSearchCriteria('pageSize')}\n                      onSortedChange={this._updateSearchCriteria('sorted')}\n                      onFilteredChange={this._updateSearchCriteria('filtered')}\n                      loading={loading}\n                      pages={pages}\n                      className='-striped -highlight'\n                    />\n                  </div>\n                </section>\n              </div>\n            </div>\n          </div>\n        </section>\n        <footer className='footer-card' style={{ padding: '2rem 0rem' }}>\n          <div className='footer-page'>\n            <div className='footer-p1'>\n              Â© Copyright Link Management Systems. All rights reserved\n            </div>\n            <div className='footer-p2'>Powered by Link Brokerages</div>\n          </div>\n        </footer>\n      </div>\n    )\n  }\n\n  _moveUpToPartner = async (id, rank, cash) => {\n    const {\n      sorted = DEFAULT_SEARCH_CRITERIA.sorted,\n      pageSize = DEFAULT_SEARCH_CRITERIA.pageSize,\n      page = DEFAULT_SEARCH_CRITERIA.page,\n      filtered = DEFAULT_SEARCH_CRITERIA.filtered\n    } = querystring.parse(this.props.router.query)\n    sorted.forEach(sort => (sort.desc = sort.desc === 'true'))\n    await userService.updateRankAndCash(id, rank, cash)\n    toastr.success('Saved')\n    this._fetchData({ pageSize, page, sorted, filtered })\n  }\n\n  /**\n   * Whenever the table model changes, or the user sorts or changes pages, this method gets called and passed the current table model.\n   * You can set the `loading` prop of the table to true to use the built-in one or show you're own loading bar if you want.\n   * @param state\n   * @return {Promise.<void>}\n   * @private\n   */\n  _fetchData = async ({\n    pageSize = DEFAULT_SEARCH_CRITERIA.pageSize,\n    page = DEFAULT_SEARCH_CRITERIA.page,\n    sorted = DEFAULT_SEARCH_CRITERIA.sorted,\n    filtered = DEFAULT_SEARCH_CRITERIA.filtered\n  }) => {\n    this.setState({ loading: true })\n\n    // Convert react-table search criteria into value that service can understand\n    const where = filtered.reduce(\n      (acc, val) => {\n        switch (val.id) {\n          case 'rank':\n            if (val.value === Rank.AGENT) {\n              acc[val.id] = Rank.AGENT\n            } else if (val.value === Rank.VICE_PRESIDENT) {\n              acc[val.id] = Rank.VICE_PRESIDENT\n            } else if (val.value === Rank.EXECUTIVE_AGENT) {\n              acc[val.id] = Rank.EXECUTIVE_AGENT\n            } else if (val.value === Rank.PARTNER) {\n              acc[val.id] = Rank.PARTNER\n            }\n            break\n          case 'id': {\n            acc[val.id] = val.value\n            break\n          }\n          default: {\n            acc[val.id] = { regexp: `/${val.value}/i` }\n          }\n        }\n        return acc\n      },\n      { or: [{ rank: Rank.AGENT }, { rank: Rank.EXECUTIVE_AGENT }] }\n    )\n    const order =\n      _.get(sorted, '[0].id', 'createdAt') +\n      ` ${_.get(sorted, '[0].desc') ? 'desc' : 'asc'}`\n\n    try {\n      const { total, users } = await userService.getUsersForAdmin({\n        where,\n        skip: pageSize * page,\n        order,\n        limit: pageSize\n      })\n      const pages = Math.ceil(total / pageSize)\n      // Show the last page if user intentionally hard-code the page value on browser URL to be very large\n      const newState = { pages, users }\n      if (page > pages - 1) {\n        newState.searchCriteria = {\n          ...this.state.searchCriteria,\n          page: Math.max(0, pages - 1) // Avoid edge case when pages = 0 resulting in -1 value, should be at least 0\n        }\n      }\n      this.setState(newState)\n\n      // Persist search criteria to browser URL\n      const pagePath = `/manage-agents?${querystring.stringify({\n        pageSize,\n        page,\n        sorted,\n        filtered\n      })}`\n      Router.replaceRoute(pagePath)\n    } catch (e) {\n      toastr.error(e.message)\n    } finally {\n      this.setState({ loading: false })\n    }\n  }\n\n  _deleteUser = async id => {\n    if (confirm('Are you sure you wish to delete this user?')) {\n      try {\n        this.setState({ loading: true })\n        await userService.deleteUserWithId(id)\n        await this._fetchData(this.state.searchCriteria)\n      } catch (error) {\n        toastr.error(error)\n      } finally {\n        this.setState({ loading: false })\n      }\n    }\n  }\n\n  _updateSearchCriteria = key => value => {\n    this.setState({\n      searchCriteria: {\n        ...this.state.searchCriteria,\n        [key]: value\n      }\n    })\n  }\n}\n\nexport default userOnly(ManageAgents)\n"]},"metadata":{},"sourceType":"module"}