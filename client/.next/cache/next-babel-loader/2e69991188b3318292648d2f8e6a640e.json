{"ast":null,"code":"import _Set from \"@babel/runtime-corejs2/core-js/set\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/defineProperty\";\nimport React, { Component } from 'react';\nimport { Modal } from 'reactstrap';\nimport { Formik, Field } from 'formik';\nimport DatePicker from 'react-datepicker';\nimport toastr from 'toastr';\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css';\nimport Calendar from '../../component/Calendar';\nimport { getRoleLabel } from '../../view-models/User';\nimport { getFullName } from '../../../common/view-models/TransactionParty';\nimport { transactionService, eventService } from '../../services';\n\nvar CreateEventModal =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateEventModal, _Component);\n\n  function CreateEventModal(props) {\n    var _this;\n\n    _classCallCheck(this, CreateEventModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CreateEventModal).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"_onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(values, action) {\n        var setSubmitting;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setSubmitting = action.setSubmitting; // const updatedTime = values.time\n                // const newDate = new Date(this.props.defaultDate)\n                // updatedTime.setFullYear(newDate.getFullYear())\n                // updatedTime.setMonth(newDate.getMonth())\n                // updatedTime.setDate(newDate.getDate())\n\n                _context.prev = 1;\n                setSubmitting(true);\n                _context.next = 5;\n                return eventService.create({\n                  title: values.title,\n                  description: values.description,\n                  transactionId: values.transactionId,\n                  time: values.time,\n                  sharedUserIds: _this.state.listUserId,\n                  creatorUserId: _this.props.currentUser.id\n                });\n\n              case 5:\n                setSubmitting(false);\n\n                _this.props.refetchData();\n\n                _this.props.toggle();\n\n                toastr.success('Success');\n                _context.next = 15;\n                break;\n\n              case 11:\n                _context.prev = 11;\n                _context.t0 = _context[\"catch\"](1);\n                toastr.error(_context.t0.message);\n                setSubmitting(false);\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[1, 11]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderSelectTransaction\", function () {\n      var transactions = _this.props.transactions;\n      return transactions.map(function (transaction, index) {\n        return !(transaction.status === 'archived') && React.createElement(\"option\", {\n          key: index,\n          value: transaction.id\n        }, transaction.address);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_getDetailedTransaction\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(transactionId) {\n        var detailedTransaction, checklist, i;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return transactionService.getPartiesForTransaction(transactionId);\n\n              case 2:\n                detailedTransaction = _context2.sent;\n\n                _this.setState({\n                  detailedTransaction: detailedTransaction,\n                  listUserId: []\n                });\n\n                checklist = document.getElementsByClassName('check-box-list');\n\n                if (checklist) {\n                  for (i = 0; i < checklist.length; i++) {\n                    checklist[i].checked = false;\n                  }\n                }\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_updateListUserId\", function (e) {\n      var newArray = _toConsumableArray(new _Set([].concat(_toConsumableArray(_this.state.listUserId), [e.target.value])));\n\n      if (e.target.checked) {\n        _this.setState({\n          listUserId: newArray\n        });\n      } else {\n        var index = _this.state.listUserId.findIndex(function (item) {\n          return item === e.target.value;\n        });\n\n        _this.state.listUserId.splice(index, 1);\n\n        _this.setState({\n          listUserId: _this.state.listUserId\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderPartiesForTransaction\", function () {\n      var detailedTransaction = _this.state.detailedTransaction;\n\n      if (detailedTransaction) {\n        return _this.state.detailedTransaction.parties.map(function (party, index) {\n          return React.createElement(\"div\", {\n            key: index,\n            className: \"col-12 col-md-6\"\n          }, React.createElement(\"label\", null, React.createElement(\"input\", {\n            onChange: _this.handleChange,\n            name: \"partyId\",\n            type: \"checkbox\",\n            className: \"check-box-list\",\n            value: party.userId\n          }), \"\\u2002\", React.createElement(\"small\", null, getRoleLabel(party.role)), \"\\xA0\", React.createElement(\"small\", null, \"(\", getFullName(party), \")\")));\n        });\n      }\n    });\n\n    _this.state = {\n      time: props.defaultDate || new Date(),\n      detailedTransaction: null,\n      listUserId: []\n    };\n    return _this;\n  }\n\n  _createClass(CreateEventModal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var toggle = this.props.toggle;\n      return React.createElement(Modal, {\n        isOpen: toggle,\n        toggle: toggle,\n        id: \"new-event-modal\",\n        modalTransition: {\n          timeout: 0\n        }\n      }, React.createElement(\"div\", {\n        className: \"modal-header modal-header--change\"\n      }, React.createElement(\"div\", {\n        className: \"text-center w-100\"\n      }, React.createElement(\"h5\", {\n        className: \"modal-title font-weight-bold\",\n        id: \"exampleModalLabel\"\n      }, \"ADD NEW EVENT\"), React.createElement(\"small\", null, \"All events added will be shared only with the parties chosen below.\"), React.createElement(\"br\", null), React.createElement(\"small\", null, \"Parties will be notified that a new event is in their calendar.\")), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close bg-transparent\",\n        \"data-dismiss\": \"modal\",\n        onClick: toggle\n      }, \"\\xD7\")), React.createElement(Formik, {\n        initialValues: {\n          time: this.props.defaultDate || new Date(),\n          title: '',\n          description: '',\n          // transactionId: this.props.transactions[0]\n          //   ? this.props.transactions[0].id\n          //   : null,\n          transactionId: '',\n          sharedUserIds: ''\n        },\n        onSubmit: this._onSubmit,\n        validate: function validate(values) {\n          var error = {};\n\n          if (values.title === '') {\n            error.title = 'Event Title is required';\n          } else if (values.description === '') {\n            error.description = 'Description is required';\n          } else if (values.transactionId === '') {\n            error.transaction = 'Transaction is required';\n          }\n\n          return error;\n        }\n      }, function (_ref3) {\n        var values = _ref3.values,\n            isValid = _ref3.isValid,\n            errors = _ref3.errors,\n            isSubmitting = _ref3.isSubmitting,\n            handleSubmit = _ref3.handleSubmit,\n            handleChange = _ref3.handleChange;\n        return React.createElement(\"form\", {\n          onSubmit: handleSubmit\n        }, React.createElement(\"div\", {\n          className: \"modal-body px-5 mx-2\"\n        }, React.createElement(\"div\", {\n          id: \"calendar\"\n        }, React.createElement(\"div\", {\n          className: \"row\"\n        }, React.createElement(\"div\", {\n          className: \"col-10\"\n        }, React.createElement(Calendar, {\n          unselectAuto: false,\n          defaultView: \"dayGridMonth\",\n          allDaySlot: false,\n          allDayDefault: true,\n          dateClick: function dateClick(_ref4) {\n            var dateStr = _ref4.dateStr;\n            var updatedTime = values.time;\n            var newDate = new Date(dateStr.replace(/-/g, '/'));\n            updatedTime.setFullYear(newDate.getFullYear());\n            updatedTime.setMonth(newDate.getMonth());\n            updatedTime.setDate(newDate.getDate());\n            handleChange({\n              time: updatedTime\n            });\n          },\n          selectable: true,\n          selectMirror: true,\n          header: {\n            left: 'prev',\n            center: 'title',\n            right: 'next'\n          },\n          myRef:\n          /*#__PURE__*/\n          function () {\n            var _ref5 = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee3(calendarRef) {\n              return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      if (calendarRef) {\n                        _context3.next = 2;\n                        break;\n                      }\n\n                      return _context3.abrupt(\"return\", null);\n\n                    case 2:\n                      _context3.next = 4;\n                      return calendarRef.getApi().gotoDate(_this2.state.time);\n\n                    case 4:\n                      _context3.next = 6;\n                      return calendarRef.getApi().select(_this2.state.time);\n\n                    case 6:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3);\n            }));\n\n            return function (_x4) {\n              return _ref5.apply(this, arguments);\n            };\n          }(),\n          height: \"auto\"\n        })), React.createElement(\"div\", {\n          className: \"col-2 pt-5 mt-4\"\n        }, React.createElement(\"div\", {\n          className: \"text-center\"\n        }, React.createElement(DatePicker, {\n          style: {\n            height: '100%'\n          },\n          selected: values.time,\n          onChange: function onChange(newTime) {\n            var updatedTime = values.time;\n            updatedTime.setHours(newTime.getHours());\n            updatedTime.setMinutes(newTime.getMinutes());\n            handleChange({\n              time: updatedTime\n            });\n          },\n          showTimeSelect: true,\n          showTimeSelectOnly: true,\n          timeIntervals: 30,\n          timeCaption: \"Time\",\n          dateFormat: \"h:mm aa\",\n          inline: true\n        }))))), React.createElement(\"div\", {\n          className: \"mt-4\"\n        }, React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Event Title\"), React.createElement(\"input\", {\n          className: \"form-control\",\n          placeholder: \"Event Title\",\n          name: \"title\",\n          onChange: handleChange,\n          value: values.title\n        }), errors.title && React.createElement(\"div\", {\n          className: \"text-danger text-center\"\n        }, errors.title)), React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Description\"), React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"input\", {\n          className: \"form-control\",\n          placeholder: \"Description\",\n          name: \"description\",\n          onChange: handleChange,\n          value: values.description\n        })), errors.description && React.createElement(\"div\", {\n          className: \"text-danger text-center\"\n        }, errors.description)), React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Share With\"), React.createElement(Field, {\n          component: \"select\",\n          name: \"transactionId\",\n          className: \"form-control\",\n          onChange:\n          /*#__PURE__*/\n          function () {\n            var _ref6 = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee4(e) {\n              return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                while (1) {\n                  switch (_context4.prev = _context4.next) {\n                    case 0:\n                      handleChange(e);\n                      _context4.next = 3;\n                      return _this2._getDetailedTransaction(e.target.value);\n\n                    case 3:\n                    case \"end\":\n                      return _context4.stop();\n                  }\n                }\n              }, _callee4);\n            }));\n\n            return function (_x5) {\n              return _ref6.apply(this, arguments);\n            };\n          }()\n        }, React.createElement(\"option\", {\n          selected: true,\n          hidden: true\n        }, \"Transactions\"), _this2._renderSelectTransaction()), errors.transaction && React.createElement(\"div\", {\n          className: \"text-danger text-center\"\n        }, errors.transaction), React.createElement(\"div\", {\n          className: \"form-group mt-3\"\n        }, React.createElement(\"div\", {\n          id: \"shared-user-id\",\n          className: \"row container m-auto\",\n          name: \"sharedUserIds\",\n          onChange: function onChange(e) {\n            handleChange(e);\n\n            _this2._updateListUserId(e);\n          }\n        }, _this2._renderPartiesForTransaction(handleChange))))), React.createElement(\"div\", {\n          className: \"text-center my-5\"\n        }, React.createElement(\"button\", {\n          disabled: !isValid || isSubmitting,\n          type: \"submit\",\n          className: \"btn text-white py-2 px-5 bg-info\"\n        }, isSubmitting && React.createElement(\"span\", {\n          className: \"spinner-border spinner-border-sm mr-2\"\n        }), \"ADD EVENT\"))));\n      }));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {}\n  }]);\n\n  return CreateEventModal;\n}(Component);\n\nexport { CreateEventModal as default };","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/Calendar/CreateEventModal.js"],"names":["React","Component","Modal","Formik","Field","DatePicker","toastr","Calendar","getRoleLabel","getFullName","transactionService","eventService","CreateEventModal","props","values","action","setSubmitting","create","title","description","transactionId","time","sharedUserIds","state","listUserId","creatorUserId","currentUser","id","refetchData","toggle","success","error","message","transactions","map","transaction","index","status","address","getPartiesForTransaction","detailedTransaction","setState","checklist","document","getElementsByClassName","i","length","checked","e","newArray","target","value","findIndex","item","splice","parties","party","handleChange","userId","role","defaultDate","Date","timeout","_onSubmit","isValid","errors","isSubmitting","handleSubmit","dateStr","updatedTime","newDate","replace","setFullYear","getFullYear","setMonth","getMonth","setDate","getDate","left","center","right","calendarRef","getApi","gotoDate","select","height","newTime","setHours","getHours","setMinutes","getMinutes","_getDetailedTransaction","_renderSelectTransaction","_updateListUserId","_renderPartiesForTransaction"],"mappings":";;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,KAAT,QAAsB,YAAtB;AACA,SAASC,MAAT,EAAiBC,KAAjB,QAA8B,QAA9B;AACA,OAAOC,UAAP,MAAuB,kBAAvB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAO,kEAAP;AACA,OAAOC,QAAP,MAAqB,0BAArB;AACA,SAASC,YAAT,QAA6B,wBAA7B;AACA,SAASC,WAAT,QAA4B,8CAA5B;AACA,SAASC,kBAAT,EAA6BC,YAA7B,QAAiD,gBAAjD;;IAEqBC,gB;;;;;AACnB,4BAAaC,KAAb,EAAoB;AAAA;;AAAA;;AAClB,0FAAMA,KAAN;;AADkB;AAAA;AAAA;AAAA;AAAA;AAAA,+BASR,iBAAOC,MAAP,EAAeC,MAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AACFC,gBAAAA,aADE,GACgBD,MADhB,CACFC,aADE,EAEV;AACA;AACA;AACA;AACA;;AANU;AAQRA,gBAAAA,aAAa,CAAC,IAAD,CAAb;AARQ;AAAA,uBASFL,YAAY,CAACM,MAAb,CAAoB;AACxBC,kBAAAA,KAAK,EAAEJ,MAAM,CAACI,KADU;AAExBC,kBAAAA,WAAW,EAAEL,MAAM,CAACK,WAFI;AAGxBC,kBAAAA,aAAa,EAAEN,MAAM,CAACM,aAHE;AAIxBC,kBAAAA,IAAI,EAAEP,MAAM,CAACO,IAJW;AAKxBC,kBAAAA,aAAa,EAAE,MAAKC,KAAL,CAAWC,UALF;AAMxBC,kBAAAA,aAAa,EAAE,MAAKZ,KAAL,CAAWa,WAAX,CAAuBC;AANd,iBAApB,CATE;;AAAA;AAkBRX,gBAAAA,aAAa,CAAC,KAAD,CAAb;;AACA,sBAAKH,KAAL,CAAWe,WAAX;;AACA,sBAAKf,KAAL,CAAWgB,MAAX;;AACAvB,gBAAAA,MAAM,CAACwB,OAAP,CAAe,SAAf;AArBQ;AAAA;;AAAA;AAAA;AAAA;AAuBRxB,gBAAAA,MAAM,CAACyB,KAAP,CAAa,YAAEC,OAAf;AACAhB,gBAAAA,aAAa,CAAC,KAAD,CAAb;;AAxBQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OATQ;;AAAA;AAAA;AAAA;AAAA;;AAAA,+EA0PO,YAAM;AAAA,UACvBiB,YADuB,GACN,MAAKpB,KADC,CACvBoB,YADuB;AAE/B,aAAOA,YAAY,CAACC,GAAb,CACL,UAACC,WAAD,EAAcC,KAAd;AAAA,eACE,EAAED,WAAW,CAACE,MAAZ,KAAuB,UAAzB,KACE;AAAQ,UAAA,GAAG,EAAED,KAAb;AAAoB,UAAA,KAAK,EAAED,WAAW,CAACR;AAAvC,WACGQ,WAAW,CAACG,OADf,CAFJ;AAAA,OADK,CAAP;AAQD,KApQmB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAsQM,kBAAMlB,aAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACUV,kBAAkB,CAAC6B,wBAAnB,CAChCnB,aADgC,CADV;;AAAA;AAClBoB,gBAAAA,mBADkB;;AAIxB,sBAAKC,QAAL,CAAc;AAAED,kBAAAA,mBAAmB,EAAnBA,mBAAF;AAAuBhB,kBAAAA,UAAU,EAAE;AAAnC,iBAAd;;AACMkB,gBAAAA,SALkB,GAKNC,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,CALM;;AAMxB,oBAAIF,SAAJ,EAAe;AACb,uBAASG,CAAT,GAAa,CAAb,EAAgBA,CAAC,GAAGH,SAAS,CAACI,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACzCH,oBAAAA,SAAS,CAACG,CAAD,CAAT,CAAaE,OAAb,GAAuB,KAAvB;AACD;AACF;;AAVuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAtQN;;AAAA;AAAA;AAAA;AAAA;;AAAA,wEAmRA,UAAAC,CAAC,EAAI;AACvB,UAAIC,QAAQ,sBAAO,sCAAY,MAAK1B,KAAL,CAAWC,UAAvB,IAAmCwB,CAAC,CAACE,MAAF,CAASC,KAA5C,GAAP,CAAZ;;AACA,UAAIH,CAAC,CAACE,MAAF,CAASH,OAAb,EAAsB;AACpB,cAAKN,QAAL,CAAc;AAAEjB,UAAAA,UAAU,EAAEyB;AAAd,SAAd;AACD,OAFD,MAEO;AACL,YAAMb,KAAK,GAAG,MAAKb,KAAL,CAAWC,UAAX,CAAsB4B,SAAtB,CACZ,UAAAC,IAAI;AAAA,iBAAIA,IAAI,KAAKL,CAAC,CAACE,MAAF,CAASC,KAAtB;AAAA,SADQ,CAAd;;AAGA,cAAK5B,KAAL,CAAWC,UAAX,CAAsB8B,MAAtB,CAA6BlB,KAA7B,EAAoC,CAApC;;AACA,cAAKK,QAAL,CAAc;AAAEjB,UAAAA,UAAU,EAAE,MAAKD,KAAL,CAAWC;AAAzB,SAAd;AACD;AACF,KA9RmB;;AAAA,mFAgSW,YAAM;AAAA,UAC3BgB,mBAD2B,GACH,MAAKjB,KADF,CAC3BiB,mBAD2B;;AAEnC,UAAIA,mBAAJ,EAAyB;AACvB,eAAO,MAAKjB,KAAL,CAAWiB,mBAAX,CAA+Be,OAA/B,CAAuCrB,GAAvC,CAA2C,UAACsB,KAAD,EAAQpB,KAAR;AAAA,iBAChD;AAAK,YAAA,GAAG,EAAEA,KAAV;AAAiB,YAAA,SAAS,EAAC;AAA3B,aACE,mCACE;AACE,YAAA,QAAQ,EAAE,MAAKqB,YADjB;AAEE,YAAA,IAAI,EAAC,SAFP;AAGE,YAAA,IAAI,EAAC,UAHP;AAIE,YAAA,SAAS,EAAC,gBAJZ;AAKE,YAAA,KAAK,EAAED,KAAK,CAACE;AALf,YADF,YASE,mCAAQlD,YAAY,CAACgD,KAAK,CAACG,IAAP,CAApB,CATF,UAWE,wCAASlD,WAAW,CAAC+C,KAAD,CAApB,MAXF,CADF,CADgD;AAAA,SAA3C,CAAP;AAiBD;AACF,KArTmB;;AAElB,UAAKjC,KAAL,GAAa;AACXF,MAAAA,IAAI,EAAER,KAAK,CAAC+C,WAAN,IAAqB,IAAIC,IAAJ,EADhB;AAEXrB,MAAAA,mBAAmB,EAAE,IAFV;AAGXhB,MAAAA,UAAU,EAAE;AAHD,KAAb;AAFkB;AAOnB;;;;6BA8BS;AAAA;;AAAA,UACAK,MADA,GACW,KAAKhB,KADhB,CACAgB,MADA;AAER,aACE,oBAAC,KAAD;AACE,QAAA,MAAM,EAAEA,MADV;AAEE,QAAA,MAAM,EAAEA,MAFV;AAGE,QAAA,EAAE,EAAC,iBAHL;AAIE,QAAA,eAAe,EAAE;AAAEiC,UAAAA,OAAO,EAAE;AAAX;AAJnB,SAME;AAAK,QAAA,SAAS,EAAC;AAAf,SACE;AAAK,QAAA,SAAS,EAAC;AAAf,SACE;AAAI,QAAA,SAAS,EAAC,8BAAd;AAA6C,QAAA,EAAE,EAAC;AAAhD,yBADF,EAIE,yGAJF,EAQE,+BARF,EASE,qGATF,CADF,EAcE;AACE,QAAA,IAAI,EAAC,QADP;AAEE,QAAA,SAAS,EAAC,sBAFZ;AAGE,wBAAa,OAHf;AAIE,QAAA,OAAO,EAAEjC;AAJX,gBAdF,CANF,EA6BE,oBAAC,MAAD;AACE,QAAA,aAAa,EAAE;AACbR,UAAAA,IAAI,EAAE,KAAKR,KAAL,CAAW+C,WAAX,IAA0B,IAAIC,IAAJ,EADnB;AAEb3C,UAAAA,KAAK,EAAE,EAFM;AAGbC,UAAAA,WAAW,EAAE,EAHA;AAIb;AACA;AACA;AACAC,UAAAA,aAAa,EAAE,EAPF;AAQbE,UAAAA,aAAa,EAAE;AARF,SADjB;AAWE,QAAA,QAAQ,EAAE,KAAKyC,SAXjB;AAYE,QAAA,QAAQ,EAAE,kBAAAjD,MAAM,EAAI;AAClB,cAAIiB,KAAK,GAAG,EAAZ;;AACA,cAAIjB,MAAM,CAACI,KAAP,KAAiB,EAArB,EAAyB;AACvBa,YAAAA,KAAK,CAACb,KAAN,GAAc,yBAAd;AACD,WAFD,MAEO,IAAIJ,MAAM,CAACK,WAAP,KAAuB,EAA3B,EAA+B;AACpCY,YAAAA,KAAK,CAACZ,WAAN,GAAoB,yBAApB;AACD,WAFM,MAEA,IAAIL,MAAM,CAACM,aAAP,KAAyB,EAA7B,EAAiC;AACtCW,YAAAA,KAAK,CAACI,WAAN,GAAoB,yBAApB;AACD;;AACD,iBAAOJ,KAAP;AACD;AAtBH,SAwBG;AAAA,YACCjB,MADD,SACCA,MADD;AAAA,YAECkD,OAFD,SAECA,OAFD;AAAA,YAGCC,MAHD,SAGCA,MAHD;AAAA,YAICC,YAJD,SAICA,YAJD;AAAA,YAKCC,YALD,SAKCA,YALD;AAAA,YAMCV,YAND,SAMCA,YAND;AAAA,eAQC;AAAM,UAAA,QAAQ,EAAEU;AAAhB,WACE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAK,UAAA,EAAE,EAAC;AAAR,WACE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE,oBAAC,QAAD;AACE,UAAA,YAAY,EAAE,KADhB;AAEE,UAAA,WAAW,EAAC,cAFd;AAGE,UAAA,UAAU,EAAE,KAHd;AAIE,UAAA,aAAa,MAJf;AAKE,UAAA,SAAS,EAAE,0BAAiB;AAAA,gBAAdC,OAAc,SAAdA,OAAc;AAC1B,gBAAMC,WAAW,GAAGvD,MAAM,CAACO,IAA3B;AACA,gBAAMiD,OAAO,GAAG,IAAIT,IAAJ,CAASO,OAAO,CAACG,OAAR,CAAgB,IAAhB,EAAsB,GAAtB,CAAT,CAAhB;AACAF,YAAAA,WAAW,CAACG,WAAZ,CAAwBF,OAAO,CAACG,WAAR,EAAxB;AACAJ,YAAAA,WAAW,CAACK,QAAZ,CAAqBJ,OAAO,CAACK,QAAR,EAArB;AACAN,YAAAA,WAAW,CAACO,OAAZ,CAAoBN,OAAO,CAACO,OAAR,EAApB;AACApB,YAAAA,YAAY,CAAC;AAAEpC,cAAAA,IAAI,EAAEgD;AAAR,aAAD,CAAZ;AACD,WAZH;AAaE,UAAA,UAAU,MAbZ;AAcE,UAAA,YAAY,MAdd;AAeE,UAAA,MAAM,EAAE;AACNS,YAAAA,IAAI,EAAE,MADA;AAENC,YAAAA,MAAM,EAAE,OAFF;AAGNC,YAAAA,KAAK,EAAE;AAHD,WAfV;AAoBE,UAAA,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAE,kBAAMC,WAAN;AAAA;AAAA;AAAA;AAAA;AAAA,0BACAA,WADA;AAAA;AAAA;AAAA;;AAAA,wDAEI,IAFJ;;AAAA;AAAA;AAAA,6BAICA,WAAW,CAACC,MAAZ,GAAqBC,QAArB,CAA8B,MAAI,CAAC5D,KAAL,CAAWF,IAAzC,CAJD;;AAAA;AAAA;AAAA,6BAKC4D,WAAW,CAACC,MAAZ,GAAqBE,MAArB,CAA4B,MAAI,CAAC7D,KAAL,CAAWF,IAAvC,CALD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAF;;AAAA;AAAA;AAAA;AAAA,aApBP;AA2BE,UAAA,MAAM,EAAC;AA3BT,UADF,CADF,EAgCE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE,oBAAC,UAAD;AACE,UAAA,KAAK,EAAE;AAAEgE,YAAAA,MAAM,EAAE;AAAV,WADT;AAEE,UAAA,QAAQ,EAAEvE,MAAM,CAACO,IAFnB;AAGE,UAAA,QAAQ,EAAE,kBAAAiE,OAAO,EAAI;AACnB,gBAAMjB,WAAW,GAAGvD,MAAM,CAACO,IAA3B;AACAgD,YAAAA,WAAW,CAACkB,QAAZ,CAAqBD,OAAO,CAACE,QAAR,EAArB;AACAnB,YAAAA,WAAW,CAACoB,UAAZ,CAAuBH,OAAO,CAACI,UAAR,EAAvB;AACAjC,YAAAA,YAAY,CAAC;AAAEpC,cAAAA,IAAI,EAAEgD;AAAR,aAAD,CAAZ;AACD,WARH;AASE,UAAA,cAAc,MAThB;AAUE,UAAA,kBAAkB,MAVpB;AAWE,UAAA,aAAa,EAAE,EAXjB;AAYE,UAAA,WAAW,EAAC,MAZd;AAaE,UAAA,UAAU,EAAC,SAbb;AAcE,UAAA,MAAM;AAdR,UADF,CADF,CAhCF,CADF,CADF,EAwDE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAI,UAAA,SAAS,EAAC;AAAd,yBADF,EAEE;AACE,UAAA,SAAS,EAAC,cADZ;AAEE,UAAA,WAAW,EAAC,aAFd;AAGE,UAAA,IAAI,EAAC,OAHP;AAIE,UAAA,QAAQ,EAAEZ,YAJZ;AAKE,UAAA,KAAK,EAAE3C,MAAM,CAACI;AALhB,UAFF,EASG+C,MAAM,CAAC/C,KAAP,IACC;AAAK,UAAA,SAAS,EAAC;AAAf,WACG+C,MAAM,CAAC/C,KADV,CAVJ,CADF,EAgBE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAI,UAAA,SAAS,EAAC;AAAd,yBADF,EAEE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AACE,UAAA,SAAS,EAAC,cADZ;AAEE,UAAA,WAAW,EAAC,aAFd;AAGE,UAAA,IAAI,EAAC,aAHP;AAIE,UAAA,QAAQ,EAAEuC,YAJZ;AAKE,UAAA,KAAK,EAAE3C,MAAM,CAACK;AALhB,UADF,CAFF,EAWG8C,MAAM,CAAC9C,WAAP,IACC;AAAK,UAAA,SAAS,EAAC;AAAf,WACG8C,MAAM,CAAC9C,WADV,CAZJ,CAhBF,EAiCE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AAAI,UAAA,SAAS,EAAC;AAAd,wBADF,EAEE,oBAAC,KAAD;AACE,UAAA,SAAS,EAAC,QADZ;AAEE,UAAA,IAAI,EAAC,eAFP;AAGE,UAAA,SAAS,EAAC,cAHZ;AAIE,UAAA,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,qCAAE,kBAAM6B,CAAN;AAAA;AAAA;AAAA;AAAA;AACRS,sBAAAA,YAAY,CAACT,CAAD,CAAZ;AADQ;AAAA,6BAEF,MAAI,CAAC2C,uBAAL,CAA6B3C,CAAC,CAACE,MAAF,CAASC,KAAtC,CAFE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAF;;AAAA;AAAA;AAAA;AAAA;AAJV,WASE;AAAQ,UAAA,QAAQ,MAAhB;AAAiB,UAAA,MAAM;AAAvB,0BATF,EAYG,MAAI,CAACyC,wBAAL,EAZH,CAFF,EAgBG3B,MAAM,CAAC9B,WAAP,IACC;AAAK,UAAA,SAAS,EAAC;AAAf,WACG8B,MAAM,CAAC9B,WADV,CAjBJ,EAsBE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AACE,UAAA,EAAE,EAAC,gBADL;AAEE,UAAA,SAAS,EAAC,sBAFZ;AAGE,UAAA,IAAI,EAAC,eAHP;AAIE,UAAA,QAAQ,EAAE,kBAAAa,CAAC,EAAI;AACbS,YAAAA,YAAY,CAACT,CAAD,CAAZ;;AACA,YAAA,MAAI,CAAC6C,iBAAL,CAAuB7C,CAAvB;AACD;AAPH,WASG,MAAI,CAAC8C,4BAAL,CAAkCrC,YAAlC,CATH,CADF,CAtBF,CAjCF,CAxDF,EA8HE;AAAK,UAAA,SAAS,EAAC;AAAf,WACE;AACE,UAAA,QAAQ,EAAE,CAACO,OAAD,IAAYE,YADxB;AAEE,UAAA,IAAI,EAAC,QAFP;AAGE,UAAA,SAAS,EAAC;AAHZ,WAKGA,YAAY,IACX;AAAM,UAAA,SAAS,EAAC;AAAhB,UANJ,cADF,CA9HF,CADF,CARD;AAAA,OAxBH,CA7BF,CADF;AA+MD;;;wCAEoB,CAAE;;;;EAzPqBjE,S;;SAAzBW,gB","sourcesContent":["import React, { Component } from 'react'\nimport { Modal } from 'reactstrap'\nimport { Formik, Field } from 'formik'\nimport DatePicker from 'react-datepicker'\nimport toastr from 'toastr'\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css'\nimport Calendar from '../../component/Calendar'\nimport { getRoleLabel } from '../../view-models/User'\nimport { getFullName } from '../../../common/view-models/TransactionParty'\nimport { transactionService, eventService } from '../../services'\n\nexport default class CreateEventModal extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      time: props.defaultDate || new Date(),\n      detailedTransaction: null,\n      listUserId: []\n    }\n  }\n\n  _onSubmit = async (values, action) => {\n    const { setSubmitting } = action\n    // const updatedTime = values.time\n    // const newDate = new Date(this.props.defaultDate)\n    // updatedTime.setFullYear(newDate.getFullYear())\n    // updatedTime.setMonth(newDate.getMonth())\n    // updatedTime.setDate(newDate.getDate())\n    try {\n      setSubmitting(true)\n      await eventService.create({\n        title: values.title,\n        description: values.description,\n        transactionId: values.transactionId,\n        time: values.time,\n        sharedUserIds: this.state.listUserId,\n        creatorUserId: this.props.currentUser.id\n      })\n\n      setSubmitting(false)\n      this.props.refetchData()\n      this.props.toggle()\n      toastr.success('Success')\n    } catch (e) {\n      toastr.error(e.message)\n      setSubmitting(false)\n    }\n  }\n\n  render () {\n    const { toggle } = this.props\n    return (\n      <Modal\n        isOpen={toggle}\n        toggle={toggle}\n        id='new-event-modal'\n        modalTransition={{ timeout: 0 }}\n      >\n        <div className='modal-header modal-header--change'>\n          <div className='text-center w-100'>\n            <h5 className='modal-title font-weight-bold' id='exampleModalLabel'>\n              ADD NEW EVENT\n            </h5>\n            <small>\n              All events added will be shared only with the parties chosen\n              below.\n            </small>\n            <br />\n            <small>\n              Parties will be notified that a new event is in their calendar.\n            </small>\n          </div>\n          <button\n            type='button'\n            className='close bg-transparent'\n            data-dismiss='modal'\n            onClick={toggle}\n          >\n            &times;\n          </button>\n        </div>\n        <Formik\n          initialValues={{\n            time: this.props.defaultDate || new Date(),\n            title: '',\n            description: '',\n            // transactionId: this.props.transactions[0]\n            //   ? this.props.transactions[0].id\n            //   : null,\n            transactionId: '',\n            sharedUserIds: ''\n          }}\n          onSubmit={this._onSubmit}\n          validate={values => {\n            let error = {}\n            if (values.title === '') {\n              error.title = 'Event Title is required'\n            } else if (values.description === '') {\n              error.description = 'Description is required'\n            } else if (values.transactionId === '') {\n              error.transaction = 'Transaction is required'\n            }\n            return error\n          }}\n        >\n          {({\n            values,\n            isValid,\n            errors,\n            isSubmitting,\n            handleSubmit,\n            handleChange\n          }) => (\n            <form onSubmit={handleSubmit}>\n              <div className='modal-body px-5 mx-2'>\n                <div id='calendar'>\n                  <div className='row'>\n                    <div className='col-10'>\n                      <Calendar\n                        unselectAuto={false}\n                        defaultView='dayGridMonth'\n                        allDaySlot={false}\n                        allDayDefault\n                        dateClick={({ dateStr }) => {\n                          const updatedTime = values.time\n                          const newDate = new Date(dateStr.replace(/-/g, '/'))\n                          updatedTime.setFullYear(newDate.getFullYear())\n                          updatedTime.setMonth(newDate.getMonth())\n                          updatedTime.setDate(newDate.getDate())\n                          handleChange({ time: updatedTime })\n                        }}\n                        selectable\n                        selectMirror\n                        header={{\n                          left: 'prev',\n                          center: 'title',\n                          right: 'next'\n                        }}\n                        myRef={async calendarRef => {\n                          if (!calendarRef) {\n                            return null\n                          }\n                          await calendarRef.getApi().gotoDate(this.state.time)\n                          await calendarRef.getApi().select(this.state.time)\n                        }}\n                        height='auto'\n                      />\n                    </div>\n                    <div className='col-2 pt-5 mt-4'>\n                      <div className='text-center'>\n                        <DatePicker\n                          style={{ height: '100%' }}\n                          selected={values.time}\n                          onChange={newTime => {\n                            const updatedTime = values.time\n                            updatedTime.setHours(newTime.getHours())\n                            updatedTime.setMinutes(newTime.getMinutes())\n                            handleChange({ time: updatedTime })\n                          }}\n                          showTimeSelect\n                          showTimeSelectOnly\n                          timeIntervals={30}\n                          timeCaption='Time'\n                          dateFormat='h:mm aa'\n                          inline\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div className='mt-4'>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Event Title</h5>\n                    <input\n                      className='form-control'\n                      placeholder='Event Title'\n                      name='title'\n                      onChange={handleChange}\n                      value={values.title}\n                    />\n                    {errors.title && (\n                      <div className='text-danger text-center'>\n                        {errors.title}\n                      </div>\n                    )}\n                  </div>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Description</h5>\n                    <div className='form-group'>\n                      <input\n                        className='form-control'\n                        placeholder='Description'\n                        name='description'\n                        onChange={handleChange}\n                        value={values.description}\n                      />\n                    </div>\n                    {errors.description && (\n                      <div className='text-danger text-center'>\n                        {errors.description}\n                      </div>\n                    )}\n                  </div>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Share With</h5>\n                    <Field\n                      component='select'\n                      name='transactionId'\n                      className='form-control'\n                      onChange={async e => {\n                        handleChange(e)\n                        await this._getDetailedTransaction(e.target.value)\n                      }}\n                    >\n                      <option selected hidden>\n                        Transactions\n                      </option>\n                      {this._renderSelectTransaction()}\n                    </Field>\n                    {errors.transaction && (\n                      <div className='text-danger text-center'>\n                        {errors.transaction}\n                      </div>\n                    )}\n\n                    <div className='form-group mt-3'>\n                      <div\n                        id='shared-user-id'\n                        className='row container m-auto'\n                        name='sharedUserIds'\n                        onChange={e => {\n                          handleChange(e)\n                          this._updateListUserId(e)\n                        }}\n                      >\n                        {this._renderPartiesForTransaction(handleChange)}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div className='text-center my-5'>\n                  <button\n                    disabled={!isValid || isSubmitting}\n                    type='submit'\n                    className='btn text-white py-2 px-5 bg-info'\n                  >\n                    {isSubmitting && (\n                      <span className='spinner-border spinner-border-sm mr-2' />\n                    )}\n                    ADD EVENT\n                  </button>\n                </div>\n              </div>\n            </form>\n          )}\n        </Formik>\n      </Modal>\n    )\n  }\n\n  componentDidMount () {}\n\n  _renderSelectTransaction = () => {\n    const { transactions } = this.props\n    return transactions.map(\n      (transaction, index) =>\n        !(transaction.status === 'archived') && (\n          <option key={index} value={transaction.id}>\n            {transaction.address}\n          </option>\n        )\n    )\n  }\n\n  _getDetailedTransaction = async transactionId => {\n    const detailedTransaction = await transactionService.getPartiesForTransaction(\n      transactionId\n    )\n    this.setState({ detailedTransaction, listUserId: [] })\n    const checklist = document.getElementsByClassName('check-box-list')\n    if (checklist) {\n      for (let i = 0; i < checklist.length; i++) {\n        checklist[i].checked = false\n      }\n    }\n  }\n\n  _updateListUserId = e => {\n    let newArray = [...new Set([...this.state.listUserId, e.target.value])]\n    if (e.target.checked) {\n      this.setState({ listUserId: newArray })\n    } else {\n      const index = this.state.listUserId.findIndex(\n        item => item === e.target.value\n      )\n      this.state.listUserId.splice(index, 1)\n      this.setState({ listUserId: this.state.listUserId })\n    }\n  }\n\n  _renderPartiesForTransaction = () => {\n    const { detailedTransaction } = this.state\n    if (detailedTransaction) {\n      return this.state.detailedTransaction.parties.map((party, index) => (\n        <div key={index} className='col-12 col-md-6'>\n          <label>\n            <input\n              onChange={this.handleChange}\n              name='partyId'\n              type='checkbox'\n              className='check-box-list'\n              value={party.userId}\n            />\n            &ensp;\n            <small>{getRoleLabel(party.role)}</small>\n            &nbsp;\n            <small>({getFullName(party)})</small>\n          </label>\n        </div>\n      ))\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}