{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _ from 'lodash';\nimport { ConfigurationId, SystemInitializationStatus } from '../../common/models/Configuration';\nimport { validateUser } from '../validators/UserValidator';\n\nvar ApplicationService =\n/*#__PURE__*/\nfunction () {\n  function ApplicationService(options) {\n    _classCallCheck(this, ApplicationService);\n\n    this.applicationGateway = options.applicationGateway;\n  }\n\n  _createClass(ApplicationService, [{\n    key: \"saveEmailAddressVerification\",\n    value: function () {\n      var _saveEmailAddressVerification = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(data) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", this.applicationGateway.saveConfiguration({\n                  id: ConfigurationId.MAIL_EMAIL_ADDRESS_VERIFICATION,\n                  data: data\n                }));\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function saveEmailAddressVerification(_x) {\n        return _saveEmailAddressVerification.apply(this, arguments);\n      }\n\n      return saveEmailAddressVerification;\n    }()\n  }, {\n    key: \"saveResetPassword\",\n    value: function () {\n      var _saveResetPassword = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(data) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.applicationGateway.saveConfiguration({\n                  id: ConfigurationId.MAIL_RESET_PASSWORD,\n                  data: data\n                }));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function saveResetPassword(_x2) {\n        return _saveResetPassword.apply(this, arguments);\n      }\n\n      return saveResetPassword;\n    }()\n  }, {\n    key: \"emailTransactionInvitation\",\n    value: function () {\n      var _emailTransactionInvitation = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(data) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", this.applicationGateway.saveConfiguration({\n                  id: ConfigurationId.MAIL_INVITATION,\n                  data: data\n                }));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function emailTransactionInvitation(_x3) {\n        return _emailTransactionInvitation.apply(this, arguments);\n      }\n\n      return emailTransactionInvitation;\n    }()\n  }, {\n    key: \"emailDocumentAddAction\",\n    value: function () {\n      var _emailDocumentAddAction = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(data) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.applicationGateway.saveConfiguration({\n                  id: ConfigurationId.MAIL_ADD_ACTION,\n                  data: data\n                }));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function emailDocumentAddAction(_x4) {\n        return _emailDocumentAddAction.apply(this, arguments);\n      }\n\n      return emailDocumentAddAction;\n    }()\n  }, {\n    key: \"saveSmtpSettings\",\n    value: function () {\n      var _saveSmtpSettings = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(data) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.applicationGateway.saveConfiguration({\n                  id: ConfigurationId.MAIL_SMTP_SETTINGS,\n                  data: data\n                }));\n\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function saveSmtpSettings(_x5) {\n        return _saveSmtpSettings.apply(this, arguments);\n      }\n\n      return saveSmtpSettings;\n    }()\n  }, {\n    key: \"getConfigurations\",\n    value: function () {\n      var _getConfigurations = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(keys) {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                return _context6.abrupt(\"return\", this.applicationGateway.getConfigurations(keys));\n\n              case 1:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function getConfigurations(_x6) {\n        return _getConfigurations.apply(this, arguments);\n      }\n\n      return getConfigurations;\n    }()\n  }, {\n    key: \"isValidSmtpEmailSettings\",\n    value: function () {\n      var _isValidSmtpEmailSettings = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee7(settings) {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                return _context7.abrupt(\"return\", this.applicationGateway.verifySmtpEmailSettings(settings));\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function isValidSmtpEmailSettings(_x7) {\n        return _isValidSmtpEmailSettings.apply(this, arguments);\n      }\n\n      return isValidSmtpEmailSettings;\n    }()\n  }, {\n    key: \"checkAppHasBeenSetup\",\n    value: function () {\n      var _checkAppHasBeenSetup = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee8() {\n        var config;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                _context8.next = 3;\n                return this.applicationGateway.getConfiguration(ConfigurationId.SYSTEM_INITIALIZATION);\n\n              case 3:\n                config = _context8.sent;\n                return _context8.abrupt(\"return\", !!(config && config.status === SystemInitializationStatus.FINISHED));\n\n              case 7:\n                _context8.prev = 7;\n                _context8.t0 = _context8[\"catch\"](0);\n                return _context8.abrupt(\"return\", true);\n\n              case 10:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this, [[0, 7]]);\n      }));\n\n      function checkAppHasBeenSetup() {\n        return _checkAppHasBeenSetup.apply(this, arguments);\n      }\n\n      return checkAppHasBeenSetup;\n    }()\n  }, {\n    key: \"validateInitSystemPassword\",\n    value: function () {\n      var _validateInitSystemPassword = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee9(password) {\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                return _context9.abrupt(\"return\", this.applicationGateway.validateInitSystemPassword(password));\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function validateInitSystemPassword(_x8) {\n        return _validateInitSystemPassword.apply(this, arguments);\n      }\n\n      return validateInitSystemPassword;\n    }()\n  }, {\n    key: \"initializeSystem\",\n    value: function () {\n      var _initializeSystem = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee10(_ref) {\n        var password, admin;\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                password = _ref.password, admin = _ref.admin;\n                validateUser(_.pick(admin, ['name', 'email', 'password']));\n                return _context10.abrupt(\"return\", this.applicationGateway.initializeSystem({\n                  password: password,\n                  admin: admin\n                }));\n\n              case 3:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function initializeSystem(_x9) {\n        return _initializeSystem.apply(this, arguments);\n      }\n\n      return initializeSystem;\n    }()\n  }]);\n\n  return ApplicationService;\n}();\n\nexport { ApplicationService as default };","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/services/ApplicationService.js"],"names":["_","ConfigurationId","SystemInitializationStatus","validateUser","ApplicationService","options","applicationGateway","data","saveConfiguration","id","MAIL_EMAIL_ADDRESS_VERIFICATION","MAIL_RESET_PASSWORD","MAIL_INVITATION","MAIL_ADD_ACTION","MAIL_SMTP_SETTINGS","keys","getConfigurations","settings","verifySmtpEmailSettings","getConfiguration","SYSTEM_INITIALIZATION","config","status","FINISHED","password","validateInitSystemPassword","admin","pick","initializeSystem"],"mappings":";;;;AAAA,OAAOA,CAAP,MAAc,QAAd;AACA,SACEC,eADF,EAEEC,0BAFF,QAGO,mCAHP;AAIA,SAASC,YAAT,QAA6B,6BAA7B;;IAUqBC,kB;;;AACnB,8BAAaC,OAAb,EAAmE;AAAA;;AACjE,SAAKC,kBAAL,GAA0BD,OAAO,CAACC,kBAAlC;AACD;;;;;;;gDAEmCC,I;;;;;iDAC3B,KAAKD,kBAAL,CAAwBE,iBAAxB,CAA0C;AAC/CC,kBAAAA,EAAE,EAAER,eAAe,CAACS,+BAD2B;AAE/CH,kBAAAA,IAAI,EAAJA;AAF+C,iBAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAMgBA,I;;;;;kDAChB,KAAKD,kBAAL,CAAwBE,iBAAxB,CAA0C;AAC/CC,kBAAAA,EAAE,EAAER,eAAe,CAACU,mBAD2B;AAE/CJ,kBAAAA,IAAI,EAAJA;AAF+C,iBAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAMyBA,I;;;;;kDACzB,KAAKD,kBAAL,CAAwBE,iBAAxB,CAA0C;AAC/CC,kBAAAA,EAAE,EAAER,eAAe,CAACW,eAD2B;AAE/CL,kBAAAA,IAAI,EAAJA;AAF+C,iBAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAMqBA,I;;;;;kDACrB,KAAKD,kBAAL,CAAwBE,iBAAxB,CAA0C;AAC/CC,kBAAAA,EAAE,EAAER,eAAe,CAACY,eAD2B;AAE/CN,kBAAAA,IAAI,EAAJA;AAF+C,iBAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAMeA,I;;;;;kDACf,KAAKD,kBAAL,CAAwBE,iBAAxB,CAA0C;AAC/CC,kBAAAA,EAAE,EAAER,eAAe,CAACa,kBAD2B;AAE/CP,kBAAAA,IAAI,EAAJA;AAF+C,iBAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAMgBQ,I;;;;;kDAChB,KAAKT,kBAAL,CAAwBU,iBAAxB,CAA0CD,IAA1C,C;;;;;;;;;;;;;;;;;;;;;iDAGuBE,Q;;;;;kDACvB,KAAKX,kBAAL,CAAwBY,uBAAxB,CAAgDD,QAAhD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBAKgB,KAAKX,kBAAL,CAAwBa,gBAAxB,CACnBlB,eAAe,CAACmB,qBADG,C;;;AAAfC,gBAAAA,M;kDAGC,CAAC,EAAEA,MAAM,IAAIA,MAAM,CAACC,MAAP,KAAkBpB,0BAA0B,CAACqB,QAAzD,C;;;;;kDAED,I;;;;;;;;;;;;;;;;;;;;;iDAIuBC,Q;;;;;kDACzB,KAAKlB,kBAAL,CAAwBmB,0BAAxB,CAAmDD,QAAnD,C;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGiBA,gBAAAA,Q,QAAAA,Q,EAAUE,K,QAAAA,K;AAClCvB,gBAAAA,YAAY,CAACH,CAAC,CAAC2B,IAAF,CAAOD,KAAP,EAAc,CAAC,MAAD,EAAS,OAAT,EAAkB,UAAlB,CAAd,CAAD,CAAZ;mDACO,KAAKpB,kBAAL,CAAwBsB,gBAAxB,CAAyC;AAAEJ,kBAAAA,QAAQ,EAARA,QAAF;AAAYE,kBAAAA,KAAK,EAALA;AAAZ,iBAAzC,C;;;;;;;;;;;;;;;;;;;;;SAjEUtB,kB","sourcesContent":["import _ from 'lodash'\nimport {\n  ConfigurationId,\n  SystemInitializationStatus\n} from '../../common/models/Configuration'\nimport { validateUser } from '../validators/UserValidator'\n\nexport interface IApplicationGateway {\n  saveConfiguration({ id: string, data: Object }): Promise<Object>;\n\n  getConfigurations(keys: [String]): Promise<[Object]>;\n\n  verifySmtpEmailSettings(settings: Object): Promise<boolean>;\n}\n\nexport default class ApplicationService {\n  constructor (options: { applicationGateway: IApplicationGateway }) {\n    this.applicationGateway = options.applicationGateway\n  }\n\n  async saveEmailAddressVerification (data) {\n    return this.applicationGateway.saveConfiguration({\n      id: ConfigurationId.MAIL_EMAIL_ADDRESS_VERIFICATION,\n      data\n    })\n  }\n\n  async saveResetPassword (data) {\n    return this.applicationGateway.saveConfiguration({\n      id: ConfigurationId.MAIL_RESET_PASSWORD,\n      data\n    })\n  }\n\n  async emailTransactionInvitation (data) {\n    return this.applicationGateway.saveConfiguration({\n      id: ConfigurationId.MAIL_INVITATION,\n      data\n    })\n  }\n\n  async emailDocumentAddAction (data) {\n    return this.applicationGateway.saveConfiguration({\n      id: ConfigurationId.MAIL_ADD_ACTION,\n      data\n    })\n  }\n\n  async saveSmtpSettings (data) {\n    return this.applicationGateway.saveConfiguration({\n      id: ConfigurationId.MAIL_SMTP_SETTINGS,\n      data\n    })\n  }\n\n  async getConfigurations (keys) {\n    return this.applicationGateway.getConfigurations(keys)\n  }\n\n  async isValidSmtpEmailSettings (settings) {\n    return this.applicationGateway.verifySmtpEmailSettings(settings)\n  }\n\n  async checkAppHasBeenSetup () {\n    try {\n      const config = await this.applicationGateway.getConfiguration(\n        ConfigurationId.SYSTEM_INITIALIZATION\n      )\n      return !!(config && config.status === SystemInitializationStatus.FINISHED)\n    } catch (e) {\n      return true\n    }\n  }\n\n  async validateInitSystemPassword (password) {\n    return this.applicationGateway.validateInitSystemPassword(password)\n  }\n\n  async initializeSystem ({ password, admin }) {\n    validateUser(_.pick(admin, ['name', 'email', 'password']))\n    return this.applicationGateway.initializeSystem({ password, admin })\n  }\n}\n"]},"metadata":{},"sourceType":"module"}