{"ast":null,"code":"import _Set from \"@babel/runtime-corejs2/core-js/set\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/defineProperty\";\nimport React, { Component } from 'react';\nimport { Modal } from 'reactstrap';\nimport { Formik, Field } from 'formik';\nimport toastr from 'toastr';\nimport moment from 'moment';\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css';\nimport { getRoleLabel } from '../../view-models/User';\nimport { getFullName } from '../../../common/view-models/TransactionParty';\nimport { transactionService, taskService } from '../../services';\n\nvar CreateTaskModal =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateTaskModal, _Component);\n\n  function CreateTaskModal(props) {\n    var _this;\n\n    _classCallCheck(this, CreateTaskModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CreateTaskModal).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"_onSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(values, action) {\n        var setSubmitting, detailedTransaction;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setSubmitting = action.setSubmitting;\n                detailedTransaction = _this.state.detailedTransaction;\n                _context.prev = 2;\n                setSubmitting(true);\n                _context.next = 6;\n                return taskService.create({\n                  taskName: values.taskName,\n                  transactionName: detailedTransaction.address || '',\n                  deadline: values.deadline,\n                  transactionId: values.transactionId,\n                  status: _this.props.dataOfColum.id,\n                  sharedUserIds: _this.state.listUserId,\n                  creatorUserId: _this.props.currentUser.id\n                });\n\n              case 6:\n                setSubmitting(false);\n                _context.next = 9;\n                return _this.props.refetchData(_this.props.dataOfColum.id, _this.props.viewType);\n\n              case 9:\n                _this.props.toggle();\n\n                toastr.success('Success');\n                _context.next = 17;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](2);\n                toastr.error(_context.t0.message);\n                setSubmitting(false);\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 13]]);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderSelectTransaction\", function () {\n      var transactions = _this.props.transactions;\n      return transactions.map(function (transaction, index) {\n        return !(transaction.status === 'archived') && React.createElement(\"option\", {\n          key: index,\n          value: transaction.id\n        }, transaction.address);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_getDetailedTransaction\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(transactionId) {\n        var detailedTransaction, checklist, i;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return transactionService.getPartiesForTransaction(transactionId);\n\n              case 2:\n                detailedTransaction = _context2.sent;\n\n                _this.setState({\n                  detailedTransaction: detailedTransaction,\n                  listUserId: []\n                });\n\n                checklist = document.getElementsByClassName('check-box-list');\n\n                if (checklist) {\n                  for (i = 0; i < checklist.length; i++) {\n                    checklist[i].checked = false;\n                  }\n                }\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_updateListUserId\", function (e) {\n      var newArray = _toConsumableArray(new _Set([].concat(_toConsumableArray(_this.state.listUserId), [e.target.value])));\n\n      if (e.target.checked) {\n        _this.setState({\n          listUserId: newArray\n        });\n      } else {\n        var index = _this.state.listUserId.findIndex(function (item) {\n          return item === e.target.value;\n        });\n\n        _this.state.listUserId.splice(index, 1);\n\n        _this.setState({\n          listUserId: _this.state.listUserId\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderPartiesForTransaction\", function () {\n      var detailedTransaction = _this.state.detailedTransaction;\n\n      if (detailedTransaction) {\n        return _this.state.detailedTransaction.parties.map(function (party, index) {\n          return React.createElement(\"div\", {\n            key: index,\n            className: \"col-12 col-md-6\"\n          }, React.createElement(\"label\", null, React.createElement(\"input\", {\n            onChange: _this.handleChange,\n            name: \"partyId\",\n            type: \"checkbox\",\n            className: \"check-box-list\",\n            value: party.userId\n          }), \"\\u2002\", React.createElement(\"small\", null, getRoleLabel(party.role)), \"\\xA0\", React.createElement(\"small\", null, \"(\", getFullName(party), \")\")));\n        });\n      }\n    });\n\n    _this.state = {\n      detailedTransaction: null,\n      listUserId: []\n    };\n    return _this;\n  }\n\n  _createClass(CreateTaskModal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          toggle = _this$props.toggle,\n          dataOfColum = _this$props.dataOfColum;\n      return React.createElement(Modal, {\n        isOpen: toggle,\n        toggle: toggle,\n        id: \"new-task-modal\",\n        modalTransition: {\n          timeout: 0\n        }\n      }, React.createElement(\"div\", {\n        className: \"modal-header modal-header--change\"\n      }, React.createElement(\"div\", {\n        className: \"text-center w-100\"\n      }, React.createElement(\"h5\", {\n        className: \"modal-title font-weight-bold\",\n        id: \"exampleModalLabel\"\n      }, \"Add \".concat(dataOfColum.title, \" Task\")), React.createElement(\"small\", null, \"All tasks added will be shared only with the parties chosen below.\"), React.createElement(\"br\", null), React.createElement(\"small\", null, \"Parties will be notified that a new task is in their tasks page.\")), React.createElement(\"button\", {\n        type: \"button\",\n        className: \"close bg-transparent\",\n        \"data-dismiss\": \"modal\",\n        onClick: toggle\n      }, \"\\xD7\")), React.createElement(Formik, {\n        initialValues: {\n          taskName: '',\n          transactionId: '',\n          sharedUserIds: ''\n        },\n        onSubmit: this._onSubmit,\n        validate: function validate(values) {\n          var error = {};\n\n          if (values.taskName === '') {\n            error.taskName = 'Task Name is required';\n          } else if (values.transactionId === '') {\n            error.transaction = 'Transaction is required';\n          }\n\n          return error;\n        }\n      }, function (_ref3) {\n        var values = _ref3.values,\n            isValid = _ref3.isValid,\n            errors = _ref3.errors,\n            isSubmitting = _ref3.isSubmitting,\n            handleSubmit = _ref3.handleSubmit,\n            handleChange = _ref3.handleChange;\n        return React.createElement(\"form\", {\n          onSubmit: handleSubmit\n        }, React.createElement(\"div\", {\n          className: \"modal-body px-5 mx-2\"\n        }, React.createElement(\"div\", {\n          className: \"mt-4\"\n        }, React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Task Name\"), React.createElement(\"input\", {\n          className: \"form-control\",\n          placeholder: \"Task Name\",\n          name: \"taskName\",\n          onChange: handleChange,\n          value: values.taskName,\n          maxLength: \"150\"\n        }), errors.taskName && React.createElement(\"div\", {\n          className: \"text-danger text-center\"\n        }, errors.taskName)), React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Share With\"), React.createElement(Field, {\n          component: \"select\",\n          name: \"transactionId\",\n          className: \"form-control\",\n          onChange:\n          /*#__PURE__*/\n          function () {\n            var _ref4 = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee3(e) {\n              return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                while (1) {\n                  switch (_context3.prev = _context3.next) {\n                    case 0:\n                      handleChange(e);\n                      _context3.next = 3;\n                      return _this2._getDetailedTransaction(e.target.value);\n\n                    case 3:\n                    case \"end\":\n                      return _context3.stop();\n                  }\n                }\n              }, _callee3);\n            }));\n\n            return function (_x4) {\n              return _ref4.apply(this, arguments);\n            };\n          }()\n        }, React.createElement(\"option\", {\n          selected: true,\n          hidden: true\n        }, \"Transactions\"), _this2._renderSelectTransaction()), errors.transaction && React.createElement(\"div\", {\n          className: \"text-danger text-center\"\n        }, errors.transaction), React.createElement(\"div\", {\n          className: \"form-group mt-3\"\n        }, React.createElement(\"div\", {\n          id: \"shared-user-id\",\n          className: \"row container m-auto\",\n          name: \"sharedUserIds\",\n          onChange: function onChange(e) {\n            handleChange(e);\n\n            _this2._updateListUserId(e);\n          }\n        }, _this2._renderPartiesForTransaction(handleChange)))), React.createElement(\"div\", {\n          className: \"form-group\"\n        }, React.createElement(\"h5\", {\n          className: \"text-center\"\n        }, \"Deadline\"), React.createElement(\"input\", {\n          className: \"form-control\",\n          type: \"datetime-local\",\n          defaultValue: new Date(),\n          min: new Date(),\n          name: \"deadline\",\n          onChange: handleChange,\n          value: moment(values.deadline).format('YYYY-MM-DDTHH:mm')\n        }))), React.createElement(\"div\", {\n          className: \"text-center my-5\"\n        }, React.createElement(\"button\", {\n          disabled: !isValid || isSubmitting,\n          type: \"submit\",\n          className: \"btn text-white py-2 px-5 bg-info btn-green\"\n        }, isSubmitting && React.createElement(\"span\", {\n          className: \"spinner-border spinner-border-sm mr-2\"\n        }), \"Add new task\"))));\n      }));\n    }\n  }]);\n\n  return CreateTaskModal;\n}(Component);\n\nexport { CreateTaskModal as default };","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/Tasks/CreatTaskModal.js"],"names":["React","Component","Modal","Formik","Field","toastr","moment","getRoleLabel","getFullName","transactionService","taskService","CreateTaskModal","props","values","action","setSubmitting","detailedTransaction","state","create","taskName","transactionName","address","deadline","transactionId","status","dataOfColum","id","sharedUserIds","listUserId","creatorUserId","currentUser","refetchData","viewType","toggle","success","error","message","transactions","map","transaction","index","getPartiesForTransaction","setState","checklist","document","getElementsByClassName","i","length","checked","e","newArray","target","value","findIndex","item","splice","parties","party","handleChange","userId","role","timeout","title","_onSubmit","isValid","errors","isSubmitting","handleSubmit","_getDetailedTransaction","_renderSelectTransaction","_updateListUserId","_renderPartiesForTransaction","Date","format"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { Modal } from 'reactstrap'\nimport { Formik, Field } from 'formik'\nimport toastr from 'toastr'\nimport moment from 'moment'\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css'\nimport { getRoleLabel } from '../../view-models/User'\nimport { getFullName } from '../../../common/view-models/TransactionParty'\nimport { transactionService, taskService } from '../../services'\n\nexport default class CreateTaskModal extends Component {\n  constructor (props) {\n    super(props)\n    this.state = {\n      detailedTransaction: null,\n      listUserId: []\n    }\n  }\n\n  _onSubmit = async (values, action) => {\n    const { setSubmitting } = action\n    const { detailedTransaction } = this.state\n    try {\n      setSubmitting(true)\n      await taskService.create({\n        taskName: values.taskName,\n        transactionName: detailedTransaction.address || '',\n        deadline: values.deadline,\n        transactionId: values.transactionId,\n        status: this.props.dataOfColum.id,\n        sharedUserIds: this.state.listUserId,\n        creatorUserId: this.props.currentUser.id\n      })\n\n      setSubmitting(false)\n      await this.props.refetchData(\n        this.props.dataOfColum.id,\n        this.props.viewType\n      )\n\n      this.props.toggle()\n      toastr.success('Success')\n    } catch (e) {\n      toastr.error(e.message)\n      setSubmitting(false)\n    }\n  }\n\n  render () {\n    const { toggle, dataOfColum } = this.props\n    return (\n      <Modal\n        isOpen={toggle}\n        toggle={toggle}\n        id='new-task-modal'\n        modalTransition={{ timeout: 0 }}\n      >\n        <div className='modal-header modal-header--change'>\n          <div className='text-center w-100'>\n            <h5 className='modal-title font-weight-bold' id='exampleModalLabel'>\n              {`Add ${dataOfColum.title} Task`}\n            </h5>\n            <small>\n              All tasks added will be shared only with the parties chosen below.\n            </small>\n            <br />\n            <small>\n              Parties will be notified that a new task is in their tasks page.\n            </small>\n          </div>\n          <button\n            type='button'\n            className='close bg-transparent'\n            data-dismiss='modal'\n            onClick={toggle}\n          >\n            &times;\n          </button>\n        </div>\n        <Formik\n          initialValues={{\n            taskName: '',\n            transactionId: '',\n            sharedUserIds: ''\n          }}\n          onSubmit={this._onSubmit}\n          validate={values => {\n            let error = {}\n            if (values.taskName === '') {\n              error.taskName = 'Task Name is required'\n            } else if (values.transactionId === '') {\n              error.transaction = 'Transaction is required'\n            }\n            return error\n          }}\n        >\n          {({\n            values,\n            isValid,\n            errors,\n            isSubmitting,\n            handleSubmit,\n            handleChange\n          }) => (\n            <form onSubmit={handleSubmit}>\n              <div className='modal-body px-5 mx-2'>\n                <div className='mt-4'>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Task Name</h5>\n                    <input\n                      className='form-control'\n                      placeholder='Task Name'\n                      name='taskName'\n                      onChange={handleChange}\n                      value={values.taskName}\n                      maxLength='150'\n                    />\n                    {errors.taskName && (\n                      <div className='text-danger text-center'>\n                        {errors.taskName}\n                      </div>\n                    )}\n                  </div>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Share With</h5>\n                    <Field\n                      component='select'\n                      name='transactionId'\n                      className='form-control'\n                      onChange={async e => {\n                        handleChange(e)\n                        await this._getDetailedTransaction(e.target.value)\n                      }}\n                    >\n                      <option selected hidden>\n                        Transactions\n                      </option>\n                      {this._renderSelectTransaction()}\n                    </Field>\n                    {errors.transaction && (\n                      <div className='text-danger text-center'>\n                        {errors.transaction}\n                      </div>\n                    )}\n\n                    <div className='form-group mt-3'>\n                      <div\n                        id='shared-user-id'\n                        className='row container m-auto'\n                        name='sharedUserIds'\n                        onChange={e => {\n                          handleChange(e)\n                          this._updateListUserId(e)\n                        }}\n                      >\n                        {this._renderPartiesForTransaction(handleChange)}\n                      </div>\n                    </div>\n                  </div>\n                  <div className='form-group'>\n                    <h5 className='text-center'>Deadline</h5>\n                    <input\n                      className='form-control'\n                      type='datetime-local'\n                      defaultValue={new Date()}\n                      min={new Date()}\n                      name='deadline'\n                      onChange={handleChange}\n                      value={moment(values.deadline).format('YYYY-MM-DDTHH:mm')}\n                    />\n                  </div>\n                </div>\n                <div className='text-center my-5'>\n                  <button\n                    disabled={!isValid || isSubmitting}\n                    type='submit'\n                    className='btn text-white py-2 px-5 bg-info btn-green'\n                  >\n                    {isSubmitting && (\n                      <span className='spinner-border spinner-border-sm mr-2' />\n                    )}\n                    Add new task\n                  </button>\n                </div>\n              </div>\n            </form>\n          )}\n        </Formik>\n      </Modal>\n    )\n  }\n\n  _renderSelectTransaction = () => {\n    const { transactions } = this.props\n\n    return transactions.map(\n      (transaction, index) =>\n        !(transaction.status === 'archived') && (\n          <option key={index} value={transaction.id}>\n            {transaction.address}\n          </option>\n        )\n    )\n  }\n\n  _getDetailedTransaction = async transactionId => {\n    const detailedTransaction = await transactionService.getPartiesForTransaction(\n      transactionId\n    )\n    this.setState({ detailedTransaction, listUserId: [] })\n    const checklist = document.getElementsByClassName('check-box-list')\n    if (checklist) {\n      for (let i = 0; i < checklist.length; i++) {\n        checklist[i].checked = false\n      }\n    }\n  }\n\n  _updateListUserId = e => {\n    let newArray = [...new Set([...this.state.listUserId, e.target.value])]\n    if (e.target.checked) {\n      this.setState({ listUserId: newArray })\n    } else {\n      const index = this.state.listUserId.findIndex(\n        item => item === e.target.value\n      )\n      this.state.listUserId.splice(index, 1)\n      this.setState({ listUserId: this.state.listUserId })\n    }\n  }\n\n  _renderPartiesForTransaction = () => {\n    const { detailedTransaction } = this.state\n    if (detailedTransaction) {\n      return this.state.detailedTransaction.parties.map((party, index) => (\n        <div key={index} className='col-12 col-md-6'>\n          <label>\n            <input\n              onChange={this.handleChange}\n              name='partyId'\n              type='checkbox'\n              className='check-box-list'\n              value={party.userId}\n            />\n            &ensp;\n            <small>{getRoleLabel(party.role)}</small>\n            &nbsp;\n            <small>({getFullName(party)})</small>\n          </label>\n        </div>\n      ))\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}