{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/classCallCheck\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/assertThisInitialized\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/createClass\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport React, { Component } from 'react';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport Head from 'next/head';\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css';\nimport '../../../node_modules/react-calendar/dist/Calendar.css';\nimport { getRoleLabel } from '../../view-models/User';\nimport { eventService, taskService, transactionService } from '../../services';\nimport userOnly from '../../hocs/userOnly';\nimport Calendar from '../../component/Calendar';\nimport CreateEventModal from './CreateEventModal';\nimport EditEventModal from './EditEventModal';\nimport { getTransactionFullAddress, getTransactionActivity } from '../../view-models/Transaction';\n\nfunction _getEventsForUser(_x) {\n  return _getEventsForUser2.apply(this, arguments);\n}\n\nfunction _getEventsForUser2() {\n  _getEventsForUser2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(userId) {\n    var events, tasks;\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return eventService.getEventsForUser(userId);\n\n          case 2:\n            events = _context5.sent;\n            _context5.next = 5;\n            return taskService.getAllTasksForUser(userId);\n\n          case 5:\n            tasks = _context5.sent;\n            return _context5.abrupt(\"return\", [].concat(_toConsumableArray(events), _toConsumableArray(tasks)));\n\n          case 7:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n  return _getEventsForUser2.apply(this, arguments);\n}\n\nvar CalendarPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CalendarPage, _Component);\n\n  _createClass(CalendarPage, null, [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(ctx) {\n        var userId, _ref, transactions, activities, events;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                userId = ctx.store.getState().global.loginUser.data.id;\n                _context.next = 3;\n                return transactionService.getMyTransactionsAndActivitiesForUser(userId);\n\n              case 3:\n                _ref = _context.sent;\n                transactions = _ref.transactions;\n                activities = _ref.activities;\n                _context.next = 8;\n                return _getEventsForUser(userId);\n\n              case 8:\n                events = _context.sent;\n                return _context.abrupt(\"return\", {\n                  transactions: transactions,\n                  activities: activities,\n                  events: events,\n                  headerText: 'Calendar'\n                });\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x2) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  function CalendarPage(props) {\n    var _this;\n\n    _classCallCheck(this, CalendarPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CalendarPage).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"_showCreateEventModal\", function (defaultDate) {\n      _this.setState({\n        showCreateEventModal: true,\n        defaultDateForCreateEventModal: defaultDate\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_showEditEventModal\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(data) {\n        var detailedTransaction;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return transactionService.getPartiesForTransaction(data.transactionId);\n\n              case 2:\n                detailedTransaction = _context2.sent;\n\n                _this.setState({\n                  showEditEventModal: true,\n                  dataEdit: {\n                    event: data,\n                    detailedTransaction: detailedTransaction // defaultDateForCreateEventModal: `${data.time}`,\n\n                  }\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"_deleteEvent\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(id) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!confirm('Are you sure you wish to delete this event ?')) {\n                  _context3.next = 13;\n                  break;\n                }\n\n                _context3.prev = 1;\n                _context3.next = 4;\n                return eventService.deleteEventWithId(id);\n\n              case 4:\n                _this.setState({\n                  loading: true\n                });\n\n                _this._refetchData();\n\n                _context3.next = 10;\n                break;\n\n              case 8:\n                _context3.prev = 8;\n                _context3.t0 = _context3[\"catch\"](1);\n\n              case 10:\n                _context3.prev = 10;\n\n                _this.setState({\n                  loading: false\n                });\n\n                return _context3.finish(10);\n\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[1, 8, 10, 13]]);\n      }));\n\n      return function (_x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleEvents\", function (e) {\n      _this.setState({\n        selectedEventId: e.event.id\n      });\n\n      _this._scrollToEventInfo();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderSelectedEventInfo\", function () {\n      var event = _this.state.events.find(function (event) {\n        return event.id === _this.state.selectedEventId;\n      });\n\n      if (!event) {\n        return null;\n      }\n\n      var transaction = _this.props.transactions.find(function (item) {\n        return item.id === event.transactionId;\n      }); // return `${new Date(event.time).getDate()} ${getTransactionFullAddress(transaction)} ${moment(event.time).format('LT')}`\n\n\n      return React.createElement(\"div\", {\n        className: \"row ml-0 p-3 mr-0 mb-2\",\n        id: \"eventCalendar\"\n      }, React.createElement(\"div\", {\n        className: \"col-10 row\"\n      }, React.createElement(\"div\", {\n        className: \"row col-12 col-sm-4 py-2\"\n      }, React.createElement(\"div\", {\n        className: \"col-2\"\n      }, React.createElement(\"div\", {\n        className: \"dayEvent text-white\",\n        style: {\n          whiteSpace: 'pre-wrap'\n        }\n      }, new Date(event.time || event.deadline).getDate())), React.createElement(\"div\", {\n        className: \"col-10 cropText\",\n        style: {\n          whiteSpace: 'pre-wrap'\n        }\n      }, event.title || event.taskName)), transaction && React.createElement(\"div\", {\n        className: \"col-12 col-sm-6 py-2\"\n      }, React.createElement(\"div\", {\n        className: \"row\"\n      }, React.createElement(\"div\", {\n        className: \"col-1 p-0 text-center\"\n      }, React.createElement(\"i\", {\n        style: {\n          fontSize: '10px'\n        },\n        className: \"fa fa-circle\"\n      })), React.createElement(\"div\", {\n        className: \"col-11 cropText\",\n        style: {\n          whiteSpace: 'pre-wrap'\n        }\n      }, getTransactionFullAddress(transaction)))), React.createElement(\"div\", {\n        className: \"col-12 col-sm-2 py-2\"\n      }, React.createElement(\"div\", {\n        className: \"row\"\n      }, React.createElement(\"div\", {\n        className: \"col-1 p-0 text-center\"\n      }, React.createElement(\"i\", {\n        style: {\n          fontSize: '10px'\n        },\n        className: \"fa fa-circle\"\n      })), React.createElement(\"div\", {\n        className: \"col-11\"\n      }, moment(event.time || event.deadline).format('LT')))), !event.taskName && React.createElement(\"div\", {\n        className: \"col-12\"\n      }, React.createElement(\"div\", {\n        className: \"row\"\n      }, React.createElement(\"div\", {\n        className: \"col-1 d-md-none d-sm-block p-0 text-center\"\n      }, React.createElement(\"i\", {\n        style: {\n          fontSize: '10px'\n        },\n        className: \"fa fa-circle\"\n      })), React.createElement(\"div\", {\n        className: \"d-md-block d-sm-none d-none p-0 text-primary font-weight-bold\"\n      }, \"Description:\"), React.createElement(\"div\", {\n        className: \"col-8 cropText\"\n      }, event.description)))), !event.taskName ? _this._renderButtonUpdateAndDeleteEvent(event) : React.createElement(\"div\", {\n        className: \"col-2 py-2\"\n      }, React.createElement(\"div\", {\n        className: \"row\"\n      }, React.createElement(\"div\", {\n        className: \"col-1 p-0 text-center\"\n      }, React.createElement(\"i\", {\n        style: {\n          fontSize: '10px'\n        },\n        className: \"fa fa-circle\"\n      })), React.createElement(\"div\", {\n        className: \"col-11\"\n      }, \"Task\"))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderButtonUpdateAndDeleteEvent\", function (event) {\n      if (_this.props.currentUser.id === event.creatorUserId && !_this._isEventOfArchivedTransaction(event)) {\n        return React.createElement(\"div\", {\n          className: \"col-10 col-sm-2 d-flex row justify-content-end align-items-start\"\n        }, React.createElement(\"button\", {\n          className: \"btn mr-1\",\n          style: {\n            background: '#4a90e2',\n            color: 'white'\n          },\n          onClick: function onClick() {\n            _this._showEditEventModal(event);\n          }\n        }, React.createElement(\"i\", {\n          className: \"fa fa-edit\"\n        })), React.createElement(\"button\", {\n          className: \"btn btn-danger\",\n          onClick: function onClick() {\n            return _this._deleteEvent(_this.state.selectedEventId);\n          }\n        }, React.createElement(\"i\", {\n          className: \"fa fa-trash\"\n        })));\n      } else {\n        return null;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_isEventOfArchivedTransaction\", function (event) {\n      var detailTransaction = _this.props.transactions.find(function (transaction) {\n        return transaction.id === event.transactionId;\n      });\n\n      if (detailTransaction.status === 'archived') {\n        return true;\n      } else {\n        return false;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_scrollToEventInfo\", function () {\n      if (_this.refs['event-info']) {\n        _this.refs['event-info'].scrollIntoView({\n          behavior: 'smooth',\n          block: 'end'\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_renderTimeline\", function () {\n      var groupTimes = _.groupBy(_this.props.activities, function (item) {\n        return moment(item.createdAt).format('L');\n      });\n\n      var groupTimesArray = _.chain(groupTimes).toPairs().sort(function (a, b) {\n        return b - a;\n      }).value();\n\n      return groupTimesArray.map(function (activity, index) {\n        return React.createElement(React.Fragment, {\n          key: index\n        }, React.createElement(\"p\", {\n          className: \"mt-3 ml-2\"\n        }, activity[0]), activity[1].map(function (itemTime, index) {\n          return React.createElement(\"div\", {\n            className: \"border-bottom p-0 row\",\n            key: index\n          }, React.createElement(\"div\", {\n            className: \"col-2 col-sm-1 col-md-1 col-xl-2  row align-items-center position-relative\"\n          }, React.createElement(\"div\", {\n            className: \"circle-timeline position-absolute timeline-sidebar_circle\"\n          })), React.createElement(\"div\", {\n            className: \"col-10 col-sm-11 col-md-11 col-xl-10 text-left \"\n          }, React.createElement(\"div\", null, React.createElement(\"b\", null, getRoleLabel(itemTime.role))), React.createElement(\"span\", {\n            className: \"card-text \"\n          }, React.createElement(\"b\", null, moment(itemTime.createdAt).format('LT'))), React.createElement(\"br\", null), React.createElement(\"span\", null, \"\".concat(itemTime.data ? itemTime.data.title : '', \" \").concat(getTransactionActivity(itemTime.type), \" \").concat(itemTime.data ? getRoleLabel(itemTime.data.currentRole) : ''))));\n        }));\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_toggleModal\", function () {\n      _this.setState({\n        showCreateEventModal: !_this.state.showCreateEventModal\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_toggleEditModal\", function () {\n      _this.setState({\n        showEditEventModal: !_this.state.showEditEventModal\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_refetchData\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee4() {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.t0 = _this;\n              _context4.next = 3;\n              return _getEventsForUser(_this.props.currentUser.id);\n\n            case 3:\n              _context4.t1 = _context4.sent;\n              _context4.t2 = {\n                events: _context4.t1\n              };\n\n              _context4.t0.setState.call(_context4.t0, _context4.t2);\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    })));\n\n    _this.state = {\n      isSubmit: true,\n      date: new Date(),\n      events: props.events,\n      showCreateEventModal: false,\n      showEditEventModal: false,\n      selectedEventId: null,\n      toggleTimeline: false,\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(CalendarPage, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        className: \"box-main\"\n      }, React.createElement(Head, null, React.createElement(\"title\", null, \"Calendar\")), React.createElement(\"div\", {\n        className: \"row m-0\",\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          width: '100%'\n        }\n      }, React.createElement(\"div\", {\n        className: \"calendar-new\",\n        id: \"calendar\",\n        style: {\n          overflow: 'unset',\n          width: '100%'\n        }\n      }, React.createElement(\"div\", {\n        className: \"box-calendar\"\n      }, React.createElement(Calendar, {\n        defaultView: \"dayGridMonth\",\n        displayEventTime: false,\n        dateClick: function dateClick(_ref5) {\n          var view = _ref5.view,\n              dayEl = _ref5.dayEl,\n              dateStr = _ref5.dateStr;\n\n          if (view.dateProfileGenerator.viewSpec.type === 'timeGridWeek') {\n            _this2._showCreateEventModal(new Date(dateStr));\n          } else {\n            _this2._showCreateEventModal(new Date(dateStr.replace(/-/g, '/')));\n          }\n        },\n        selectable: true,\n        selectMirror: true,\n        events: this.state.events.map(function (event) {\n          return {\n            title: _.truncate(event.title || event.taskName, {\n              length: 20\n            }),\n            date: event.time || event.deadline,\n            id: event.id,\n            classNames: _this2.state.selectedEventId === event.id ? ['fc-event', 'fc-event--selected'] : ['fc-event']\n          };\n        }),\n        customButtons: {\n          myCustomButton: {\n            text: '+',\n            click: function click() {\n              return _this2._showCreateEventModal(new Date());\n            }\n          }\n        },\n        eventClick: this.handleEvents,\n        header: {\n          left: 'dayGridMonth,timeGridWeek',\n          center: 'prev,title,next',\n          right: 'myCustomButton'\n        },\n        height: \"auto\",\n        eventLimit: \"true\"\n      }), this._renderSelectedEventInfo(), React.createElement(\"div\", {\n        ref: \"event-info\"\n      })))), React.createElement(\"footer\", {\n        className: \"footer-card\",\n        style: {\n          padding: '2rem 0rem'\n        }\n      }, React.createElement(\"div\", {\n        className: \"footer-page\"\n      }, React.createElement(\"div\", {\n        className: \"footer-p1\"\n      }, \"\\xA9 Copyright Link Management Systems. All rights reserved\"), React.createElement(\"div\", {\n        className: \"footer-p2\"\n      }, \"Powered by Link Brokerages\"))), this.state.showCreateEventModal && React.createElement(CreateEventModal, {\n        defaultDate: this.state.defaultDateForCreateEventModal,\n        transactions: this.props.transactions,\n        toggle: this._toggleModal,\n        currentUser: this.props.currentUser,\n        refetchData: this._refetchData\n      }), this.state.showEditEventModal && React.createElement(EditEventModal, {\n        defaultDate: new Date(this.state.dataEdit.event.time),\n        transactions: this.props.transactions,\n        toggle: this._toggleEditModal,\n        currentUser: this.props.currentUser,\n        refetchData: this._refetchData,\n        dataEdit: this.state.dataEdit\n      }));\n    }\n  }]);\n\n  return CalendarPage;\n}(Component);\n\nexport default userOnly(CalendarPage);","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/Calendar/index.js"],"names":["React","Component","moment","_","Head","getRoleLabel","eventService","taskService","transactionService","userOnly","Calendar","CreateEventModal","EditEventModal","getTransactionFullAddress","getTransactionActivity","_getEventsForUser","userId","getEventsForUser","events","getAllTasksForUser","tasks","CalendarPage","ctx","store","getState","global","loginUser","data","id","getMyTransactionsAndActivitiesForUser","transactions","activities","headerText","props","defaultDate","setState","showCreateEventModal","defaultDateForCreateEventModal","getPartiesForTransaction","transactionId","detailedTransaction","showEditEventModal","dataEdit","event","confirm","deleteEventWithId","loading","_refetchData","e","selectedEventId","_scrollToEventInfo","state","find","transaction","item","whiteSpace","Date","time","deadline","getDate","title","taskName","fontSize","format","description","_renderButtonUpdateAndDeleteEvent","currentUser","creatorUserId","_isEventOfArchivedTransaction","background","color","_showEditEventModal","_deleteEvent","detailTransaction","status","refs","scrollIntoView","behavior","block","groupTimes","groupBy","createdAt","groupTimesArray","chain","toPairs","sort","a","b","value","map","activity","index","itemTime","role","type","currentRole","isSubmit","date","toggleTimeline","display","alignItems","justifyContent","width","overflow","view","dayEl","dateStr","dateProfileGenerator","viewSpec","_showCreateEventModal","replace","truncate","length","classNames","myCustomButton","text","click","handleEvents","left","center","right","_renderSelectedEventInfo","padding","_toggleModal","_toggleEditModal"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport moment from 'moment'\nimport _ from 'lodash'\nimport Head from 'next/head'\nimport '../../../node_modules/react-datepicker/dist/react-datepicker.css'\nimport '../../../node_modules/react-calendar/dist/Calendar.css'\nimport { getRoleLabel } from '../../view-models/User'\nimport { eventService, taskService, transactionService } from '../../services'\nimport userOnly from '../../hocs/userOnly'\nimport Calendar from '../../component/Calendar'\nimport CreateEventModal from './CreateEventModal'\nimport EditEventModal from './EditEventModal'\nimport {\n  getTransactionFullAddress,\n  getTransactionActivity\n} from '../../view-models/Transaction'\n\nasync function _getEventsForUser (userId) {\n  const events = await eventService.getEventsForUser(userId)\n  const tasks = await taskService.getAllTasksForUser(userId)\n  return [...events, ...tasks]\n}\n\nclass CalendarPage extends Component {\n  static async getInitialProps (ctx) {\n    const userId = ctx.store.getState().global.loginUser.data.id\n    const {\n      transactions,\n      activities\n    } = await transactionService.getMyTransactionsAndActivitiesForUser(userId)\n    const events = await _getEventsForUser(userId)\n    return { transactions, activities, events, headerText: 'Calendar' }\n  }\n\n  constructor (props) {\n    super(props)\n    this.state = {\n      isSubmit: true,\n      date: new Date(),\n      events: props.events,\n      showCreateEventModal: false,\n      showEditEventModal: false,\n      selectedEventId: null,\n      toggleTimeline: false,\n      loading: false\n    }\n  }\n\n  _showCreateEventModal = defaultDate => {\n    this.setState({\n      showCreateEventModal: true,\n      defaultDateForCreateEventModal: defaultDate\n    })\n  }\n  _showEditEventModal = async data => {\n    const detailedTransaction = await transactionService.getPartiesForTransaction(\n      data.transactionId\n    )\n\n    this.setState({\n      showEditEventModal: true,\n      dataEdit: {\n        event: data,\n        detailedTransaction\n      }\n\n      // defaultDateForCreateEventModal: `${data.time}`,\n    })\n  }\n\n  _deleteEvent = async id => {\n    if (confirm('Are you sure you wish to delete this event ?')) {\n      try {\n        await eventService.deleteEventWithId(id)\n        this.setState({ loading: true })\n        this._refetchData()\n      } catch (error) {\n        // toastr.error(error)\n      } finally {\n        this.setState({ loading: false })\n      }\n    }\n  }\n\n  handleEvents = e => {\n    this.setState({\n      selectedEventId: e.event.id\n    })\n    this._scrollToEventInfo()\n  }\n\n  render () {\n    return (\n      <div className='box-main'>\n        <Head>\n          <title>Calendar</title>\n        </Head>\n        <div\n          className='row m-0'\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            width: '100%'\n          }}\n        >\n          <div\n            className='calendar-new'\n            id='calendar'\n            style={{\n              overflow: 'unset',\n              width: '100%'\n            }}\n          >\n            <div className='box-calendar'>\n              <Calendar\n                defaultView='dayGridMonth'\n                displayEventTime={false}\n                dateClick={({ view, dayEl, dateStr }) => {\n                  if (\n                    view.dateProfileGenerator.viewSpec.type === 'timeGridWeek'\n                  ) {\n                    this._showCreateEventModal(new Date(dateStr))\n                  } else {\n                    this._showCreateEventModal(\n                      new Date(dateStr.replace(/-/g, '/'))\n                    )\n                  }\n                }}\n                selectable\n                selectMirror\n                events={this.state.events.map(event => ({\n                  title: _.truncate(event.title || event.taskName, {\n                    length: 20\n                  }),\n                  date: event.time || event.deadline,\n                  id: event.id,\n                  classNames:\n                    this.state.selectedEventId === event.id\n                      ? ['fc-event', 'fc-event--selected']\n                      : ['fc-event']\n                }))}\n                customButtons={{\n                  myCustomButton: {\n                    text: '+',\n                    click: () => this._showCreateEventModal(new Date())\n                  }\n                }}\n                eventClick={this.handleEvents}\n                header={{\n                  left: 'dayGridMonth,timeGridWeek',\n                  center: 'prev,title,next',\n                  right: 'myCustomButton'\n                }}\n                height='auto'\n                eventLimit='true'\n              />\n              {this._renderSelectedEventInfo()}\n              <div ref='event-info' />\n            </div>\n          </div>\n\n          {/* display timeline */}\n          {/* <div\n            className={`timeline-sidebar ${\n              this.state.toggleTimeline\n                ? 'toggle-timeline col-xl-3 border-top d-md-block d-xl-block d-sm-block d-xs-block d-block '\n                : 'col-xl-3 border-top d-md-none d-xl-block d-sm-none d-xs-none d-none '\n            }`}\n          >\n            <div className='timeline-sidebar_wrapper'>\n              <p className='p-2 mb-0'>Timeline</p>\n              <div>{this._renderTimeline()}</div>\n            </div>\n          </div> */}\n          {/* <div className='timeline-sidebar col-3 border-top'>\n            <p>Timeline</p>\n            {this._renderTimeline()}\n          </div> */}\n        </div>\n        <footer className='footer-card' style={{ padding: '2rem 0rem' }}>\n          <div className='footer-page'>\n            <div className='footer-p1'>\n              Â© Copyright Link Management Systems. All rights reserved\n            </div>\n            <div className='footer-p2'>Powered by Link Brokerages</div>\n          </div>\n        </footer>\n        {/* {this._renderModalAddEventCalendar()} */}\n        {/* {this.renderInfoEvent()} */}\n\n        {this.state.showCreateEventModal && (\n          <CreateEventModal\n            defaultDate={this.state.defaultDateForCreateEventModal}\n            transactions={this.props.transactions}\n            toggle={this._toggleModal}\n            currentUser={this.props.currentUser}\n            refetchData={this._refetchData}\n          />\n        )}\n        {this.state.showEditEventModal && (\n          <EditEventModal\n            defaultDate={new Date(this.state.dataEdit.event.time)}\n            transactions={this.props.transactions}\n            toggle={this._toggleEditModal}\n            currentUser={this.props.currentUser}\n            refetchData={this._refetchData}\n            dataEdit={this.state.dataEdit}\n          />\n        )}\n      </div>\n    )\n  }\n\n  _renderSelectedEventInfo = () => {\n    const event = this.state.events.find(\n      event => event.id === this.state.selectedEventId\n    )\n\n    if (!event) {\n      return null\n    }\n    const transaction = this.props.transactions.find(\n      item => item.id === event.transactionId\n    )\n    // return `${new Date(event.time).getDate()} ${getTransactionFullAddress(transaction)} ${moment(event.time).format('LT')}`\n    return (\n      <div className='row ml-0 p-3 mr-0 mb-2' id='eventCalendar'>\n        <div className='col-10 row'>\n          <div className='row col-12 col-sm-4 py-2'>\n            <div className='col-2'>\n              <div\n                className='dayEvent text-white'\n                style={{ whiteSpace: 'pre-wrap' }}\n              >\n                {new Date(event.time || event.deadline).getDate()}\n              </div>\n            </div>\n            <div className='col-10 cropText' style={{ whiteSpace: 'pre-wrap' }}>\n              {event.title || event.taskName}\n            </div>\n          </div>\n          {transaction && (\n            <div className='col-12 col-sm-6 py-2'>\n              <div className='row'>\n                <div className='col-1 p-0 text-center'>\n                  <i style={{ fontSize: '10px' }} className='fa fa-circle' />\n                </div>\n                <div\n                  className='col-11 cropText'\n                  style={{ whiteSpace: 'pre-wrap' }}\n                >\n                  {getTransactionFullAddress(transaction)}\n                </div>\n              </div>\n            </div>\n          )}\n          <div className='col-12 col-sm-2 py-2'>\n            <div className='row'>\n              <div className='col-1 p-0 text-center'>\n                <i style={{ fontSize: '10px' }} className='fa fa-circle' />\n              </div>\n              <div className='col-11'>\n                {moment(event.time || event.deadline).format('LT')}\n              </div>\n            </div>\n          </div>\n          {!event.taskName && (\n            <div className='col-12'>\n              <div className='row'>\n                <div className='col-1 d-md-none d-sm-block p-0 text-center'>\n                  <i style={{ fontSize: '10px' }} className='fa fa-circle' />\n                </div>\n                <div className='d-md-block d-sm-none d-none p-0 text-primary font-weight-bold'>\n                  Description:\n                </div>\n                <div className='col-8 cropText'>{event.description}</div>\n              </div>\n            </div>\n          )}\n        </div>\n        {!event.taskName ? (\n          this._renderButtonUpdateAndDeleteEvent(event)\n        ) : (\n          <div className='col-2 py-2'>\n            <div className='row'>\n              <div className='col-1 p-0 text-center'>\n                <i style={{ fontSize: '10px' }} className='fa fa-circle' />\n              </div>\n              <div className='col-11'>Task</div>\n            </div>\n          </div>\n        )}\n      </div>\n    )\n  }\n  _renderButtonUpdateAndDeleteEvent = event => {\n    if (\n      this.props.currentUser.id === event.creatorUserId &&\n      !this._isEventOfArchivedTransaction(event)\n    ) {\n      return (\n        <div className='col-10 col-sm-2 d-flex row justify-content-end align-items-start'>\n          <button\n            className='btn mr-1'\n            style={{ background: '#4a90e2', color: 'white' }}\n            onClick={() => {\n              this._showEditEventModal(event)\n            }}\n          >\n            <i className='fa fa-edit' />\n          </button>\n          <button\n            className='btn btn-danger'\n            onClick={() => this._deleteEvent(this.state.selectedEventId)}\n          >\n            <i className='fa fa-trash' />\n          </button>\n        </div>\n      )\n    } else {\n      return null\n    }\n  }\n\n  _isEventOfArchivedTransaction = event => {\n    const detailTransaction = this.props.transactions.find(transaction => {\n      return transaction.id === event.transactionId\n    })\n    if (detailTransaction.status === 'archived') {\n      return true\n    } else {\n      return false\n    }\n  }\n\n  _scrollToEventInfo = () => {\n    if (this.refs['event-info']) {\n      this.refs['event-info'].scrollIntoView({\n        behavior: 'smooth',\n        block: 'end'\n      })\n    }\n  }\n\n  _renderTimeline = () => {\n    let groupTimes = _.groupBy(this.props.activities, function (item) {\n      return moment(item.createdAt).format('L')\n    })\n    let groupTimesArray = _.chain(groupTimes)\n      .toPairs()\n      .sort(function (a, b) {\n        return b - a\n      })\n      .value()\n\n    return groupTimesArray.map((activity, index) => (\n      <React.Fragment key={index}>\n        <p className='mt-3 ml-2'>{activity[0]}</p>\n        {activity[1].map((itemTime, index) => (\n          <div className='border-bottom p-0 row' key={index}>\n            <div className='col-2 col-sm-1 col-md-1 col-xl-2  row align-items-center position-relative'>\n              <div className='circle-timeline position-absolute timeline-sidebar_circle' />\n            </div>\n            <div className='col-10 col-sm-11 col-md-11 col-xl-10 text-left '>\n              <div>\n                <b>{getRoleLabel(itemTime.role)}</b>\n              </div>\n              <span className='card-text '>\n                <b>{moment(itemTime.createdAt).format('LT')}</b>\n              </span>\n              <br />\n              <span>{`${\n                itemTime.data ? itemTime.data.title : ''\n              } ${getTransactionActivity(itemTime.type)} ${\n                itemTime.data ? getRoleLabel(itemTime.data.currentRole) : ''\n              }`}</span>\n            </div>\n          </div>\n        ))}\n      </React.Fragment>\n    ))\n  }\n\n  _toggleModal = () => {\n    this.setState({\n      showCreateEventModal: !this.state.showCreateEventModal\n    })\n  }\n  _toggleEditModal = () => {\n    this.setState({\n      showEditEventModal: !this.state.showEditEventModal\n    })\n  }\n\n  _refetchData = async () => {\n    this.setState({\n      events: await _getEventsForUser(this.props.currentUser.id)\n    })\n  }\n}\n\nexport default userOnly(CalendarPage)\n"]},"metadata":{},"sourceType":"module"}