{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/objectSpread\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/slicedToArray\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport { some, orderBy } from 'lodash';\nimport getConfig from 'next/config';\nimport { Document, Page } from 'react-pdf';\nimport classnames from 'classnames';\nimport PreviewModal from '../TransactionFilesPage/PreviewModal';\nimport { ACTION_TYPE } from '../../view-models/Transaction';\nimport { DataAccessType, DocumentActionStatus, DocumentSpecies } from '../../../common/models/Transaction';\n\nvar _getConfig = getConfig(),\n    publicRuntimeConfig = _getConfig.publicRuntimeConfig;\n\nvar API_BASE_URL = \"\".concat(publicRuntimeConfig.BASE_URL, \"/api\");\n\nvar TransactionEnvelopes = function TransactionEnvelopes(_ref) {\n  var documentAction = _ref.documentAction,\n      listDocument = _ref.listDocument;\n  var pdfRef = useRef(null);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      document = _useState2[0],\n      setDocument = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      data = _useState4[0],\n      setData = _useState4[1];\n\n  useEffect(function () {\n    var temp = [];\n    listDocument.forEach(function (doc) {\n      if (documentAction[doc.id] && documentAction[doc.id].length > 0) {\n        var action = 'complete';\n        var order = 4;\n\n        if (some(documentAction[doc.id], {\n          status: DocumentActionStatus.TODO\n        })) {\n          // ===== Sign -> Review -> View ===== //\n          if (some(documentAction[doc.id], {\n            action: DataAccessType.SIGN_DOCUMENT,\n            status: DocumentActionStatus.TODO\n          })) {\n            action = DataAccessType.SIGN_DOCUMENT;\n            order = 1;\n          } else if (some(documentAction[doc.id], {\n            action: DataAccessType.REVIEW_DOCUMENT,\n            status: DocumentActionStatus.TODO\n          })) {\n            action = DataAccessType.REVIEW_DOCUMENT;\n            order = 2;\n          } else {\n            action = DataAccessType.VIEW_ONLY;\n            order = 3;\n          }\n        }\n\n        var actionData = documentAction[doc.id].find(function (item) {\n          return item.data && item.data.uri;\n        });\n        var paths = doc.uri.split('/');\n        temp.push(_objectSpread({}, doc, {\n          documentType: paths[paths.length - 2] === 'envelopes' && DocumentSpecies.ENVELOPE,\n          signId: actionData && actionData.id,\n          action: action,\n          order: order\n        }));\n      }\n    });\n    setData(orderBy(temp, 'order', 'asc'));\n  }, [documentAction, listDocument]);\n\n  var getLinkToDownload = function getLinkToDownload(document) {\n    if (document.signId) {\n      return \"\".concat(API_BASE_URL, \"/documentActions/\").concat(document.signId, \"/download\");\n    }\n\n    if (document.documentType === DocumentSpecies.ENVELOPE) {\n      return \"\".concat(API_BASE_URL, \"/documents/\").concat(document.id, \"/download-envelope\");\n    }\n\n    return \"\".concat(API_BASE_URL, \"/documents/\").concat(document.id, \"/download\");\n  };\n\n  return React.createElement(React.Fragment, null, data.map(function (document, index) {\n    return React.createElement(\"div\", {\n      key: \"document-\".concat(index),\n      className: \"col-md-4 mt-4\"\n    }, React.createElement(\"div\", {\n      className: \"card rounded shadow-sm h-100\"\n    }, React.createElement(\"div\", {\n      className: \"card-body d-flex flex-column justify-content-between pdf-set\"\n    }, React.createElement(\"div\", {\n      ref: pdfRef,\n      className: \"u-clickable app-document-card\",\n      onClick: function onClick() {\n        return setDocument(document);\n      }\n    }, pdfRef.current && React.createElement(Document, {\n      file: getLinkToDownload(document)\n    }, React.createElement(Page, {\n      pageNumber: 1,\n      width: pdfRef.current.clientWidth\n    }))), React.createElement(\"div\", null, React.createElement(\"button\", {\n      type: \"button\",\n      className: classnames('btn w-100 my-3', {\n        'btn--light-red': document.action === DataAccessType.SIGN_DOCUMENT\n      }, {\n        'btn--light-yellow': document.action === DataAccessType.VIEW_ONLY || document.action === DataAccessType.REVIEW_DOCUMENT\n      }, {\n        'btn--light-green': document.action === 'complete'\n      }),\n      style: {\n        borderRadius: 8\n      }\n    }, ACTION_TYPE[document.action] || 'Complete'), React.createElement(\"h6\", {\n      className: \"mb-2\",\n      style: {\n        fontWeight: 500\n      }\n    }, document.title), document.party && React.createElement(React.Fragment, null, React.createElement(\"div\", {\n      className: \"app-badge app-badge--light\"\n    }, document.party.name), React.createElement(\"div\", {\n      className: \"mt-3\"\n    }, React.createElement(\"img\", {\n      alt: \"avatar\",\n      src: document.party.avatar || '/static/images/default-avatar.png',\n      className: \"rounded-circle\",\n      style: {\n        height: 30,\n        width: 30\n      }\n    })))))));\n  }), document && React.createElement(PreviewModal, {\n    toggle: function toggle() {\n      return setDocument(null);\n    },\n    document: document\n  }));\n};\n\nexport default TransactionEnvelopes;","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/TransactionPartiesPage/TransactionEnvelopes.js"],"names":["React","useEffect","useRef","useState","some","orderBy","getConfig","Document","Page","classnames","PreviewModal","ACTION_TYPE","DataAccessType","DocumentActionStatus","DocumentSpecies","publicRuntimeConfig","API_BASE_URL","BASE_URL","TransactionEnvelopes","documentAction","listDocument","pdfRef","document","setDocument","data","setData","temp","forEach","doc","id","length","action","order","status","TODO","SIGN_DOCUMENT","REVIEW_DOCUMENT","VIEW_ONLY","actionData","find","item","uri","paths","split","push","documentType","ENVELOPE","signId","getLinkToDownload","map","index","current","clientWidth","borderRadius","fontWeight","title","party","name","avatar","height","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport { some, orderBy } from 'lodash'\nimport getConfig from 'next/config'\nimport { Document, Page } from 'react-pdf'\nimport classnames from 'classnames'\nimport PreviewModal from '../TransactionFilesPage/PreviewModal'\nimport { ACTION_TYPE } from '../../view-models/Transaction'\nimport {\n  DataAccessType,\n  DocumentActionStatus,\n  DocumentSpecies\n} from '../../../common/models/Transaction'\n\nconst { publicRuntimeConfig } = getConfig()\nconst API_BASE_URL = `${publicRuntimeConfig.BASE_URL}/api`\n\nconst TransactionEnvelopes = ({ documentAction, listDocument }) => {\n  const pdfRef = useRef(null)\n  const [document, setDocument] = useState(null)\n  const [data, setData] = useState([])\n\n  useEffect(() => {\n    let temp = []\n    listDocument.forEach(doc => {\n      if (documentAction[doc.id] && documentAction[doc.id].length > 0) {\n        let action = 'complete'\n        let order = 4\n\n        if (\n          some(documentAction[doc.id], { status: DocumentActionStatus.TODO })\n        ) {\n          // ===== Sign -> Review -> View ===== //\n          if (\n            some(documentAction[doc.id], {\n              action: DataAccessType.SIGN_DOCUMENT,\n              status: DocumentActionStatus.TODO\n            })\n          ) {\n            action = DataAccessType.SIGN_DOCUMENT\n            order = 1\n          } else if (\n            some(documentAction[doc.id], {\n              action: DataAccessType.REVIEW_DOCUMENT,\n              status: DocumentActionStatus.TODO\n            })\n          ) {\n            action = DataAccessType.REVIEW_DOCUMENT\n            order = 2\n          } else {\n            action = DataAccessType.VIEW_ONLY\n            order = 3\n          }\n        }\n\n        const actionData = documentAction[doc.id].find(\n          item => item.data && item.data.uri\n        )\n\n        const paths = doc.uri.split('/')\n        temp.push({\n          ...doc,\n          documentType:\n            paths[paths.length - 2] === 'envelopes' && DocumentSpecies.ENVELOPE,\n          signId: actionData && actionData.id,\n          action,\n          order\n        })\n      }\n    })\n\n    setData(orderBy(temp, 'order', 'asc'))\n  }, [documentAction, listDocument])\n\n  const getLinkToDownload = document => {\n    if (document.signId) {\n      return `${API_BASE_URL}/documentActions/${document.signId}/download`\n    }\n    if (document.documentType === DocumentSpecies.ENVELOPE) {\n      return `${API_BASE_URL}/documents/${document.id}/download-envelope`\n    }\n    return `${API_BASE_URL}/documents/${document.id}/download`\n  }\n\n  return (\n    <>\n      {data.map((document, index) => (\n        <div key={`document-${index}`} className='col-md-4 mt-4'>\n          <div className='card rounded shadow-sm h-100'>\n            <div className='card-body d-flex flex-column justify-content-between pdf-set'>\n              <div\n                ref={pdfRef}\n                className='u-clickable app-document-card'\n                onClick={() => setDocument(document)}\n              >\n                {pdfRef.current && (\n                  <Document file={getLinkToDownload(document)}>\n                    <Page pageNumber={1} width={pdfRef.current.clientWidth} />\n                  </Document>\n                )}\n              </div>\n              <div>\n                <button\n                  type='button'\n                  className={classnames(\n                    'btn w-100 my-3',\n                    {\n                      'btn--light-red':\n                        document.action === DataAccessType.SIGN_DOCUMENT\n                    },\n                    {\n                      'btn--light-yellow':\n                        document.action === DataAccessType.VIEW_ONLY ||\n                        document.action === DataAccessType.REVIEW_DOCUMENT\n                    },\n                    { 'btn--light-green': document.action === 'complete' }\n                  )}\n                  style={{ borderRadius: 8 }}\n                >\n                  {ACTION_TYPE[document.action] || 'Complete'}\n                </button>\n                <h6 className='mb-2' style={{ fontWeight: 500 }}>\n                  {document.title}\n                </h6>\n                {document.party && (\n                  <>\n                    <div className='app-badge app-badge--light'>\n                      {document.party.name}\n                    </div>\n                    <div className='mt-3'>\n                      <img\n                        alt='avatar'\n                        src={\n                          document.party.avatar ||\n                          '/static/images/default-avatar.png'\n                        }\n                        className='rounded-circle'\n                        style={{ height: 30, width: 30 }}\n                      />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n          </div>\n        </div>\n      ))}\n      {document && (\n        <PreviewModal toggle={() => setDocument(null)} document={document} />\n      )}\n    </>\n  )\n}\n\nexport default TransactionEnvelopes\n"]},"metadata":{},"sourceType":"module"}