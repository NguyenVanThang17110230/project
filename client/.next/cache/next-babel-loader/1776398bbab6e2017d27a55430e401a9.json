{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/objectSpread\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/slicedToArray\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport getConfig from 'next/config';\nimport { Document, Page } from 'react-pdf';\nimport PreviewModal from '../TransactionFilesPage/PreviewModal';\nimport { ACTION_TYPE } from '../../view-models/Transaction';\nimport { DataAccessType, DocumentActionStatus, DocumentSpecies, TransactionStatus } from '../../../common/models/Transaction';\nimport { transactionService } from '../../services';\n\nvar _getConfig = getConfig(),\n    publicRuntimeConfig = _getConfig.publicRuntimeConfig;\n\nvar API_BASE_URL = \"\".concat(publicRuntimeConfig.BASE_URL, \"/api\");\n\nvar TransactionDocumentActions = function TransactionDocumentActions(_ref) {\n  var documentActions = _ref.documentActions,\n      listDocument = _ref.listDocument,\n      currentParty = _ref.currentParty,\n      reFetchData = _ref.reFetchData,\n      transactionStatus = _ref.transactionStatus;\n  var pdfRef = useRef(null);\n\n  var _useState = useState(documentActions),\n      _useState2 = _slicedToArray(_useState, 2),\n      documentActionList = _useState2[0],\n      setDocumentActionList = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      document = _useState4[0],\n      setDocument = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      actionId = _useState6[0],\n      setActionId = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      actionHandling = _useState8[0],\n      setActionHandling = _useState8[1];\n\n  var _useState9 = useState([]),\n      _useState10 = _slicedToArray(_useState9, 2),\n      data = _useState10[0],\n      setData = _useState10[1];\n\n  var fetchData = function fetchData(actions) {\n    var documentInfo = {};\n    listDocument.forEach(function (doc) {\n      documentInfo[doc.id] = doc;\n    });\n    var temp = [];\n    actions.forEach(function (item) {\n      if (documentInfo[item.documentId]) {\n        var paths = documentInfo[item.documentId].uri.split('/');\n        temp.push(_objectSpread({}, item, {\n          document: _objectSpread({}, documentInfo[item.documentId], {\n            documentType: paths[paths.length - 2] === 'envelopes' && DocumentSpecies.ENVELOPE\n          })\n        }));\n      }\n    });\n    setData(temp);\n  };\n\n  useEffect(function () {\n    fetchData(documentActionList);\n  }, []);\n\n  var handleSign =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(item) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return transactionService.getSignLink(item.documentId, item.envelopeId, currentParty);\n\n            case 2:\n              res = _context.sent;\n\n              if (res && res.url) {\n                if (window) {\n                  window.open(res.url, '_blank');\n                }\n              }\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSign(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var _handleConfirm =\n  /*#__PURE__*/\n  function () {\n    var _ref3 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(actionId) {\n      var _ref4, documentActionsByPartyId;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return transactionService.makeDoneDocumentAction(actionId);\n\n            case 2:\n              _context2.next = 4;\n              return reFetchData();\n\n            case 4:\n              _ref4 = _context2.sent;\n              documentActionsByPartyId = _ref4.documentActionsByPartyId;\n              fetchData(documentActionsByPartyId);\n              setDocumentActionList(documentActionsByPartyId);\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleConfirm(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleClick =\n  /*#__PURE__*/\n  function () {\n    var _ref5 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3(item) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setActionHandling(item.id);\n              _context3.t0 = item.action;\n              _context3.next = _context3.t0 === DataAccessType.VIEW_ONLY ? 4 : _context3.t0 === DataAccessType.REVIEW_DOCUMENT ? 7 : _context3.t0 === DataAccessType.SIGN_DOCUMENT ? 10 : 15;\n              break;\n\n            case 4:\n              setDocument(item.document);\n              setActionId(item.id);\n              return _context3.abrupt(\"break\", 15);\n\n            case 7:\n              setDocument(item.document);\n              setActionId(item.id);\n              return _context3.abrupt(\"break\", 15);\n\n            case 10:\n              _context3.t1 = item.envelopeId;\n\n              if (!_context3.t1) {\n                _context3.next = 14;\n                break;\n              }\n\n              _context3.next = 14;\n              return handleSign(item);\n\n            case 14:\n              return _context3.abrupt(\"break\", 15);\n\n            case 15:\n              setActionHandling(null);\n\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleClick(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var buttonInfo = function buttonInfo(item) {\n    if (item.status === DocumentActionStatus.TODO) {\n      switch (item.action) {\n        case DataAccessType.SIGN_DOCUMENT:\n          return {\n            classnames: 'btn--red',\n            label: ACTION_TYPE[item.action]\n          };\n\n        default:\n          return {\n            classnames: 'btn--yellow',\n            label: ACTION_TYPE[item.action]\n          };\n      }\n    }\n\n    if (item.status === DocumentActionStatus.DONE) {\n      switch (item.action) {\n        case DataAccessType.SIGN_DOCUMENT:\n          return {\n            classnames: 'btn--light-red',\n            label: 'Signed'\n          };\n\n        default:\n          return {\n            classnames: 'btn--light-yellow',\n            label: ACTION_TYPE[item.action] + 'ed'\n          };\n      }\n    }\n  };\n\n  var getLinkToDownload = function getLinkToDownload(document) {\n    if (document.signId) {\n      return \"\".concat(API_BASE_URL, \"/documentActions/\").concat(document.signId, \"/download\");\n    }\n\n    if (document.documentType === DocumentSpecies.ENVELOPE) {\n      return \"\".concat(API_BASE_URL, \"/documents/\").concat(document.id, \"/download-envelope\");\n    }\n\n    return \"\".concat(API_BASE_URL, \"/documents/\").concat(document.id, \"/download\");\n  };\n\n  return React.createElement(React.Fragment, null, data.map(function (item, index) {\n    var button = buttonInfo(item);\n    return React.createElement(\"div\", {\n      key: \"document-\".concat(index),\n      className: \"col-md-4 mt-4\"\n    }, React.createElement(\"div\", {\n      className: \"card rounded shadow-sm h-100\"\n    }, React.createElement(\"div\", {\n      className: \"card-body d-flex flex-column justify-content-between\"\n    }, React.createElement(\"div\", {\n      ref: pdfRef,\n      className: \"u-clickable app-document-card\",\n      onClick: function onClick() {\n        return setDocument(item.document);\n      }\n    }, pdfRef.current && React.createElement(Document, {\n      file: getLinkToDownload(item.document)\n    }, React.createElement(Page, {\n      pageNumber: 1,\n      width: pdfRef.current.clientWidth\n    }))), React.createElement(\"div\", null, React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn w-100 my-3 \".concat(button.classnames),\n      style: {\n        borderRadius: 8\n      },\n      disabled: actionHandling === item.id || transactionStatus === TransactionStatus.CLOSED,\n      onClick: function onClick() {\n        return item.status === DocumentActionStatus.TODO && handleClick(item);\n      }\n    }, actionHandling === item.id && React.createElement(\"span\", {\n      className: \"spinner-border spinner-border-sm mr-2\"\n    }), button.label), React.createElement(\"h6\", {\n      className: \"mb-2\",\n      style: {\n        fontWeight: 500\n      }\n    }, item.document.title), item.document.party && React.createElement(React.Fragment, null, React.createElement(\"div\", {\n      className: \"app-badge app-badge--light\"\n    }, item.document.party.name), React.createElement(\"div\", {\n      className: \"mt-3\"\n    }, React.createElement(\"img\", {\n      alt: \"avatar\",\n      src: item.document.party.avatar || '/static/images/default-avatar.png',\n      className: \"rounded-circle\",\n      style: {\n        height: 30,\n        width: 30\n      }\n    })))))));\n  }), document && React.createElement(PreviewModal, {\n    toggle: function toggle() {\n      setDocument(null);\n      setActionId(null);\n    },\n    document: document,\n    actionId: actionId,\n    handleConfirm: function handleConfirm() {\n      return _handleConfirm(actionId);\n    }\n  }));\n};\n\nexport default TransactionDocumentActions;","map":{"version":3,"sources":["/home/thang/Documents/GitHub/link-webapi/client/pages/TransactionPartiesPage/TransactionDocumentActions.js"],"names":["React","useEffect","useRef","useState","getConfig","Document","Page","PreviewModal","ACTION_TYPE","DataAccessType","DocumentActionStatus","DocumentSpecies","TransactionStatus","transactionService","publicRuntimeConfig","API_BASE_URL","BASE_URL","TransactionDocumentActions","documentActions","listDocument","currentParty","reFetchData","transactionStatus","pdfRef","documentActionList","setDocumentActionList","document","setDocument","actionId","setActionId","actionHandling","setActionHandling","data","setData","fetchData","actions","documentInfo","forEach","doc","id","temp","item","documentId","paths","uri","split","push","documentType","length","ENVELOPE","handleSign","getSignLink","envelopeId","res","url","window","open","handleConfirm","makeDoneDocumentAction","documentActionsByPartyId","handleClick","action","VIEW_ONLY","REVIEW_DOCUMENT","SIGN_DOCUMENT","buttonInfo","status","TODO","classnames","label","DONE","getLinkToDownload","signId","map","index","button","current","clientWidth","borderRadius","CLOSED","fontWeight","title","party","name","avatar","height","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport getConfig from 'next/config'\nimport { Document, Page } from 'react-pdf'\nimport PreviewModal from '../TransactionFilesPage/PreviewModal'\nimport { ACTION_TYPE } from '../../view-models/Transaction'\nimport {\n  DataAccessType,\n  DocumentActionStatus,\n  DocumentSpecies,\n  TransactionStatus\n} from '../../../common/models/Transaction'\nimport { transactionService } from '../../services'\n\nconst { publicRuntimeConfig } = getConfig()\nconst API_BASE_URL = `${publicRuntimeConfig.BASE_URL}/api`\n\nconst TransactionDocumentActions = ({\n  documentActions,\n  listDocument,\n  currentParty,\n  reFetchData,\n  transactionStatus\n}) => {\n  const pdfRef = useRef(null)\n  const [documentActionList, setDocumentActionList] = useState(documentActions)\n  const [document, setDocument] = useState(null)\n  const [actionId, setActionId] = useState(null)\n  const [actionHandling, setActionHandling] = useState(null)\n  const [data, setData] = useState([])\n\n  const fetchData = actions => {\n    let documentInfo = {}\n    listDocument.forEach(doc => {\n      documentInfo[doc.id] = doc\n    })\n\n    let temp = []\n    actions.forEach(item => {\n      if (documentInfo[item.documentId]) {\n        const paths = documentInfo[item.documentId].uri.split('/')\n        temp.push({\n          ...item,\n          document: {\n            ...documentInfo[item.documentId],\n            documentType:\n              paths[paths.length - 2] === 'envelopes' &&\n              DocumentSpecies.ENVELOPE\n          }\n        })\n      }\n    })\n\n    setData(temp)\n  }\n\n  useEffect(() => {\n    fetchData(documentActionList)\n  }, [])\n\n  const handleSign = async item => {\n    const res = await transactionService.getSignLink(\n      item.documentId,\n      item.envelopeId,\n      currentParty\n    )\n    if (res && res.url) {\n      if (window) {\n        window.open(res.url, '_blank')\n      }\n    }\n  }\n\n  const handleConfirm = async actionId => {\n    await transactionService.makeDoneDocumentAction(actionId)\n    const { documentActionsByPartyId } = await reFetchData()\n    fetchData(documentActionsByPartyId)\n    setDocumentActionList(documentActionsByPartyId)\n  }\n\n  const handleClick = async item => {\n    setActionHandling(item.id)\n    switch (item.action) {\n      case DataAccessType.VIEW_ONLY:\n        setDocument(item.document)\n        setActionId(item.id)\n        break\n\n      case DataAccessType.REVIEW_DOCUMENT:\n        setDocument(item.document)\n        setActionId(item.id)\n        break\n\n      case DataAccessType.SIGN_DOCUMENT:\n        item.envelopeId && (await handleSign(item))\n        break\n    }\n    setActionHandling(null)\n  }\n\n  const buttonInfo = item => {\n    if (item.status === DocumentActionStatus.TODO) {\n      switch (item.action) {\n        case DataAccessType.SIGN_DOCUMENT:\n          return {\n            classnames: 'btn--red',\n            label: ACTION_TYPE[item.action]\n          }\n        default:\n          return {\n            classnames: 'btn--yellow',\n            label: ACTION_TYPE[item.action]\n          }\n      }\n    }\n\n    if (item.status === DocumentActionStatus.DONE) {\n      switch (item.action) {\n        case DataAccessType.SIGN_DOCUMENT:\n          return {\n            classnames: 'btn--light-red',\n            label: 'Signed'\n          }\n        default:\n          return {\n            classnames: 'btn--light-yellow',\n            label: ACTION_TYPE[item.action] + 'ed'\n          }\n      }\n    }\n  }\n\n  const getLinkToDownload = document => {\n    if (document.signId) {\n      return `${API_BASE_URL}/documentActions/${document.signId}/download`\n    }\n    if (document.documentType === DocumentSpecies.ENVELOPE) {\n      return `${API_BASE_URL}/documents/${document.id}/download-envelope`\n    }\n    return `${API_BASE_URL}/documents/${document.id}/download`\n  }\n\n  return (\n    <>\n      {data.map((item, index) => {\n        const button = buttonInfo(item)\n        return (\n          <div key={`document-${index}`} className='col-md-4 mt-4'>\n            <div className='card rounded shadow-sm h-100'>\n              <div className='card-body d-flex flex-column justify-content-between'>\n                <div\n                  ref={pdfRef}\n                  className='u-clickable app-document-card'\n                  onClick={() => setDocument(item.document)}\n                >\n                  {pdfRef.current && (\n                    <Document file={getLinkToDownload(item.document)}>\n                      <Page pageNumber={1} width={pdfRef.current.clientWidth} />\n                    </Document>\n                  )}\n                </div>\n                <div>\n                  <button\n                    type='button'\n                    className={`btn w-100 my-3 ${button.classnames}`}\n                    style={{ borderRadius: 8 }}\n                    disabled={\n                      actionHandling === item.id ||\n                      transactionStatus === TransactionStatus.CLOSED\n                    }\n                    onClick={() =>\n                      item.status === DocumentActionStatus.TODO &&\n                      handleClick(item)\n                    }\n                  >\n                    {actionHandling === item.id && (\n                      <span className='spinner-border spinner-border-sm mr-2' />\n                    )}\n                    {button.label}\n                  </button>\n                  <h6 className='mb-2' style={{ fontWeight: 500 }}>\n                    {item.document.title}\n                  </h6>\n                  {item.document.party && (\n                    <>\n                      <div className='app-badge app-badge--light'>\n                        {item.document.party.name}\n                      </div>\n                      <div className='mt-3'>\n                        <img\n                          alt='avatar'\n                          src={\n                            item.document.party.avatar ||\n                            '/static/images/default-avatar.png'\n                          }\n                          className='rounded-circle'\n                          style={{ height: 30, width: 30 }}\n                        />\n                      </div>\n                    </>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        )\n      })}\n      {document && (\n        <PreviewModal\n          toggle={() => {\n            setDocument(null)\n            setActionId(null)\n          }}\n          document={document}\n          actionId={actionId}\n          handleConfirm={() => handleConfirm(actionId)}\n        />\n      )}\n    </>\n  )\n}\n\nexport default TransactionDocumentActions\n"]},"metadata":{},"sourceType":"module"}